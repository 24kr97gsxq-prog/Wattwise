<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>‚ö° WattWise ‚Äî Texas Energy Savings</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
/* ‚îÄ‚îÄ RESET & VARIABLES ‚îÄ‚îÄ */
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html{-webkit-text-size-adjust:100%}

body {
  background: #0C1117;
  color: #E8EDF5;
  font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
  font-size: 16px;
}

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.header {
  background: #161B24;
  border-bottom: 1px solid #2A3347;
  padding: 14px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  z-index: 100;
  -webkit-backdrop-filter: blur(10px);
  backdrop-filter: blur(10px);
}
.header-logo {
  font-family: 'Bebas Neue', Georgia, 'Times New Roman', serif;
  font-size: 28px;
  letter-spacing: 2px;
  color: #F59E0B;
  line-height: 1;
}
.header-logo span { color: #E8EDF5; }
.header-badge {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 11px;
  font-weight: 600;
  background: rgba(245,158,11,0.12);
  color: #F59E0B;
  border: 1px solid rgba(245,158,11,0.25);
  padding: 5px 11px;
  border-radius: 20px;
  letter-spacing: 0.3px;
}
.dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: #10B981;
  box-shadow: 0 0 6px #10B981;
  flex-shrink: 0;
}
.dot.off { background: #EF4444; box-shadow: none; }

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tabs {
  display: flex;
  background: #161B24;
  border-bottom: 1px solid #2A3347;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.tabs::-webkit-scrollbar { display: none; }
.tab {
  flex: 1;
  min-width: 64px;
  padding: 11px 6px 9px;
  text-align: center;
  cursor: pointer;
  font-size: 10px;
  font-weight: 600;
  color: #4B5870;
  text-transform: uppercase;
  letter-spacing: 0.4px;
  border-bottom: 2px solid transparent;
  transition: color 0.2s, border-color 0.2s;
  white-space: nowrap;
  user-select: none;
  -webkit-user-select: none;
}
.tab i { font-size: 18px; display: block; margin-bottom: 2px; font-style: normal; }
.tab.active { color: #F59E0B; border-bottom-color: #F59E0B; }

/* ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ */
.panel { display: none; padding: 18px 16px 100px; }
.panel.active { display: block; animation: fadeUp 0.22s ease; }
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card {
  background: #1E2535;
  border: 1px solid #2A3347;
  border-radius: 16px;
  padding: 18px;
  margin-bottom: 14px;
}
.card-title {
  font-family: 'Bebas Neue', Georgia, serif;
  font-size: 17px;
  letter-spacing: 1px;
  color: #F59E0B;
  margin-bottom: 14px;
}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero {
  background: linear-gradient(145deg, #161B24 0%, #1a2236 100%);
  border: 1px solid #2A3347;
  border-radius: 20px;
  padding: 26px 18px 24px;
  margin-bottom: 16px;
  text-align: center;
  position: relative;
  overflow: hidden;
}
.hero::before {
  content: '';
  position: absolute;
  top: -80px; right: -80px;
  width: 240px; height: 240px;
  background: radial-gradient(circle, rgba(245,158,11,0.1) 0%, transparent 65%);
  pointer-events: none;
}
.hero-eyebrow {
  font-size: 11px;
  font-weight: 600;
  color: #F59E0B;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 8px;
}
.hero-title {
  font-family: 'Bebas Neue', Georgia, serif;
  font-size: 48px;
  line-height: 0.95;
  letter-spacing: 2px;
  color: #E8EDF5;
  margin-bottom: 8px;
}
.hero-title em { color: #F59E0B; font-style: normal; }
.hero-sub {
  font-size: 13px;
  color: #8A97AD;
  margin-bottom: 22px;
  line-height: 1.55;
}

/* ‚îÄ‚îÄ ZIP INPUT ‚îÄ‚îÄ */
.zip-row {
  display: flex;
  gap: 10px;
  max-width: 320px;
  margin: 0 auto;
}
.zip-input {
  flex: 1;
  background: #0C1117;
  border: 2px solid #2A3347;
  border-radius: 12px;
  padding: 14px 12px;
  font-size: 24px;
  font-family: 'Bebas Neue', Georgia, serif;
  letter-spacing: 4px;
  color: #E8EDF5;
  text-align: center;
  outline: none;
  -webkit-appearance: none;
  transition: border-color 0.2s;
}
.zip-input:focus { border-color: #F59E0B; }
.zip-input::placeholder { color: #4B5870; font-size: 14px; letter-spacing: 1px; font-family: 'DM Sans', sans-serif; }

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 14px 20px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 15px;
  cursor: pointer;
  border: none;
  font-family: 'DM Sans', sans-serif;
  transition: transform 0.12s, box-shadow 0.15s;
  -webkit-appearance: none;
  text-decoration: none;
}
.btn:active { transform: scale(0.95); }
.btn-primary {
  background: linear-gradient(135deg, #F59E0B, #EA580C);
  color: white;
  box-shadow: 0 4px 18px rgba(245,158,11,0.28);
}
.btn-primary:hover { box-shadow: 0 4px 24px rgba(245,158,11,0.42); }
.btn-outline {
  background: transparent;
  border: 1.5px solid #2A3347;
  color: #8A97AD;
}
.btn-outline:hover { border-color: #F59E0B; color: #F59E0B; }
.btn-sm { padding: 9px 15px; font-size: 13px; border-radius: 10px; }
.btn-full { width: 100%; }
.btn-danger { border-color: rgba(239,68,68,0.35); color: #EF4444; }

/* ‚îÄ‚îÄ SEARCHING STATE ‚îÄ‚îÄ */
#searching-overlay { display: none; padding: 36px 10px; text-align: center; }
.spinner {
  width: 50px; height: 50px;
  border-radius: 50%;
  border: 4px solid #2A3347;
  border-top-color: #F59E0B;
  animation: spin 0.75s linear infinite;
  margin: 0 auto 18px;
}
@keyframes spin { to { transform: rotate(360deg); } }
.searching-label {
  font-family: 'Bebas Neue', Georgia, serif;
  font-size: 22px;
  color: #F59E0B;
  letter-spacing: 1px;
  animation: blink 1.3s ease-in-out infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.45} }
.searching-sub { font-size: 13px; color: #8A97AD; margin-top: 5px; }

/* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
#savings-result { display: none; }

.polr-banner {
  background: rgba(239,68,68,0.08);
  border: 1px solid rgba(239,68,68,0.2);
  border-radius: 12px;
  padding: 12px 14px;
  margin-bottom: 14px;
  font-size: 13px;
  color: #FCA5A5;
  line-height: 1.5;
}

.savings-hero {
  background: #1E2535;
  border: 1px solid #2A3347;
  border-radius: 16px;
  padding: 22px 16px;
  text-align: center;
  margin-bottom: 14px;
}
.savings-eyebrow {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: #8A97AD;
  margin-bottom: 6px;
}
.savings-amount {
  font-family: 'Bebas Neue', Georgia, serif;
  font-size: 82px;
  line-height: 1;
  color: #FCD34D;
  letter-spacing: 2px;
}
.savings-period {
  font-size: 13px;
  color: #8A97AD;
  margin-top: 4px;
}
.rate-row {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 16px;
  margin: 16px 0 10px;
}
.rate-chip {
  background: #0C1117;
  border-radius: 10px;
  padding: 10px 18px;
  text-align: center;
}
.rate-chip .rv {
  font-family: 'Bebas Neue', Georgia, serif;
  font-size: 28px;
  line-height: 1;
}
.rate-chip .rl { font-size: 11px; color: #8A97AD; margin-top: 2px; }
.rate-chip.good .rv { color: #10B981; }
.rate-chip.bad  .rv { color: #EF4444; }
.arrow-sep { color: #4B5870; font-size: 20px; }
.location-label { font-size: 12px; color: #8A97AD; }

/* ‚îÄ‚îÄ PLAN CARDS ‚îÄ‚îÄ */
.section-label {
  font-family: 'Bebas Neue', Georgia, serif;
  font-size: 15px;
  letter-spacing: 1.5px;
  color: #4B5870;
  text-transform: uppercase;
  margin-bottom: 10px;
  margin-top: 4px;
}
.plan-card {
  background: #0C1117;
  border: 1px solid #2A3347;
  border-radius: 14px;
  padding: 14px 14px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 12px;
  transition: border-color 0.18s;
  cursor: default;
}
.plan-card:hover { border-color: rgba(245,158,11,0.4); }
.rank-badge {
  width: 34px; height: 34px;
  border-radius: 9px;
  background: #1E2535;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Bebas Neue', Georgia, serif;
  font-size: 19px;
  color: #8A97AD;
  flex-shrink: 0;
}
.rank-badge.top { background: rgba(245,158,11,0.18); color: #F59E0B; }
.plan-info { flex: 1; min-width: 0; }
.plan-prov { font-size: 11px; color: #8A97AD; }
.plan-name { font-weight: 600; font-size: 14px; line-height: 1.3; }
.plan-tags { display: flex; gap: 5px; margin-top: 5px; flex-wrap: wrap; }
.tag {
  font-size: 10px;
  font-weight: 600;
  padding: 2px 8px;
  border-radius: 20px;
  background: rgba(255,255,255,0.05);
  color: #8A97AD;
}
.tag.green { background: rgba(16,185,129,0.12); color: #10B981; }
.efl-link { font-size: 11px; color: #60A5FA; text-decoration: none; display: block; margin-top: 4px; }
.efl-link:hover { text-decoration: underline; }
.plan-rate-col { flex-shrink: 0; text-align: right; }
.plan-rate {
  font-family: 'Bebas Neue', Georgia, serif;
  font-size: 32px;
  color: #FCD34D;
  line-height: 1;
}
.plan-rate-sub { font-size: 11px; color: #8A97AD; }

/* ‚îÄ‚îÄ TIP JAR ‚îÄ‚îÄ */
#tip-jar {
  display: none;
  margin-top: 18px;
  background: linear-gradient(145deg, #1a1208 0%, #1c1509 100%);
  border: 1px solid rgba(245,158,11,0.28);
  border-radius: 20px;
  overflow: hidden;
  animation: popIn 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
@keyframes popIn {
  from { opacity: 0; transform: translateY(24px) scale(0.94); }
  to   { opacity: 1; transform: none; }
}
.tip-hd {
  background: linear-gradient(90deg, #EA580C, #b45309);
  padding: 15px 18px;
}
.tip-hd-eyebrow { font-size: 10px; color: rgba(255,220,150,0.65); font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 2px; }
.tip-hd-title { font-family: 'Bebas Neue', Georgia, serif; font-size: 24px; color: white; letter-spacing: 1px; }
.tip-body { padding: 16px 18px; }
.tip-copy { font-size: 13px; color: #C4A46B; line-height: 1.65; margin-bottom: 16px; }
.tip-copy strong { color: #FCD34D; }
.tip-tiers { display: grid; grid-template-columns: repeat(3, 1fr); gap: 9px; margin-bottom: 14px; }
.tier {
  background: rgba(0,0,0,0.35);
  border: 1.5px solid rgba(245,158,11,0.18);
  border-radius: 13px;
  padding: 13px 6px;
  text-align: center;
  cursor: pointer;
  position: relative;
  transition: border-color 0.18s, background 0.18s, transform 0.1s;
  -webkit-appearance: none;
  font-family: inherit;
}
.tier:hover  { border-color: #F59E0B; background: rgba(245,158,11,0.07); }
.tier:active { transform: scale(0.94); }
.tier.pop    { border-color: #F59E0B; }
.tier-badge {
  position: absolute;
  top: -9px; left: 50%; transform: translateX(-50%);
  background: #F59E0B;
  color: #000;
  font-size: 9px;
  font-weight: 800;
  padding: 2px 7px;
  border-radius: 20px;
  white-space: nowrap;
  letter-spacing: 0.3px;
}
.tier-icon  { font-size: 24px; display: block; margin-bottom: 5px; }
.tier-amt   { font-family: 'Bebas Neue', Georgia, serif; font-size: 26px; color: #FCD34D; line-height: 1; }
.tier-lbl   { font-size: 10px; color: #8A97AD; margin-top: 3px; line-height: 1.3; }
.tip-dismiss { text-align: center; }
.tip-dismiss button { background: none; border: none; font-size: 12px; color: #4B5870; cursor: pointer; text-decoration: underline; font-family: inherit; }

/* ‚îÄ‚îÄ THANKS ‚îÄ‚îÄ */
#tip-thanks {
  display: none;
  background: linear-gradient(145deg, #091a10, #0b1f12);
  border: 1px solid rgba(16,185,129,0.25);
  border-radius: 20px;
  padding: 28px 18px;
  text-align: center;
  margin-top: 18px;
  animation: popIn 0.4s ease;
}
.thanks-icon  { font-size: 50px; display: block; margin-bottom: 10px; }
.thanks-title { font-family: 'Bebas Neue', Georgia, serif; font-size: 28px; color: #10B981; margin-bottom: 8px; letter-spacing: 1px; }
.thanks-body  { font-size: 13px; color: #6EE7B7; line-height: 1.6; }

/* ‚îÄ‚îÄ TABLES ‚îÄ‚îÄ */
.rate-table { width: 100%; border-collapse: collapse; }
.rate-table th { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: #8A97AD; text-align: left; padding: 8px 10px; border-bottom: 1px solid #2A3347; }
.rate-table td { padding: 11px 10px; font-size: 13px; border-bottom: 1px solid rgba(42,51,71,0.4); }
.rate-table tr:last-child td { border-bottom: none; }
.rv-cell { font-family: 'Bebas Neue', Georgia, serif; font-size: 19px; color: #FCD34D; }
.green-cell { color: #10B981; font-weight: 600; }
.red-cell   { color: #EF4444; }

/* ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ */
.setting-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 13px 0;
  border-bottom: 1px solid #2A3347;
  gap: 12px;
}
.setting-row:last-child { border-bottom: none; }
.setting-lbl   { font-size: 14px; font-weight: 600; }
.setting-sub   { font-size: 12px; color: #8A97AD; margin-top: 2px; }
.input-wrap    { margin-bottom: 12px; }
.input-lbl     { font-size: 11px; color: #8A97AD; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; display: block; }
.field {
  background: #0C1117;
  border: 1.5px solid #2A3347;
  border-radius: 10px;
  padding: 11px 13px;
  font-size: 14px;
  color: #E8EDF5;
  width: 100%;
  outline: none;
  font-family: 'DM Sans', sans-serif;
  -webkit-appearance: none;
  transition: border-color 0.18s;
}
.field:focus { border-color: #F59E0B; }
.field-sm { width: 90px; text-align: center; }

/* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
.row    { display: flex; align-items: center; gap: 10px; }
.between { display: flex; align-items: center; justify-content: space-between; }
.empty  { text-align: center; padding: 30px 10px; color: #4B5870; font-size: 14px; }
.empty-icon { font-size: 36px; display: block; margin-bottom: 10px; }
.divider { border: none; border-top: 1px solid #2A3347; margin: 14px 0; }
.amber  { color: #F59E0B; }
.green  { color: #10B981; }
.red    { color: #EF4444; }
.sub    { color: #8A97AD; font-size: 13px; }
.bold   { font-weight: 700; }
.mt1    { margin-top: 6px; }
.mt2    { margin-top: 12px; }
.mt3    { margin-top: 18px; }
.center { text-align: center; }
.footer-note { text-align: center; padding: 8px; color: #4B5870; font-size: 11px; line-height: 1.6; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast {
  position: fixed;
  bottom: 90px; left: 50%;
  transform: translateX(-50%) translateY(10px);
  background: #1E2535;
  border: 1px solid #2A3347;
  border-radius: 12px;
  padding: 11px 20px;
  font-size: 14px;
  font-weight: 500;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s, transform 0.25s;
  white-space: nowrap;
  max-width: 90vw;
}
#toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ‚îÄ‚îÄ HISTORY ITEM ‚îÄ‚îÄ */
.history-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 0;
  border-bottom: 1px solid #2A3347;
  cursor: pointer;
}
.history-item:last-child { border-bottom: none; }
.history-item:active { opacity: 0.7; }

/* ‚îÄ‚îÄ ABOUT HERO ‚îÄ‚îÄ */
.about-hero {
  background: linear-gradient(145deg, #161B24, #1a2236);
  border: 1px solid #2A3347;
  border-radius: 20px;
  padding: 26px 18px;
  margin-bottom: 16px;
}
.about-icon  { font-size: 42px; margin-bottom: 10px; display: block; }
.about-title { font-family: 'Bebas Neue', Georgia, serif; font-size: 38px; line-height: 0.95; letter-spacing: 2px; color: #E8EDF5; margin-bottom: 8px; }
.about-title em { color: #F59E0B; font-style: normal; }
.about-sub   { font-size: 13px; color: #8A97AD; line-height: 1.6; }
.prose       { font-size: 14px; color: #8A97AD; line-height: 1.7; }
.prose strong { color: #E8EDF5; }
</style>
</head>
<body>

<!-- ‚ïê‚ïê HEADER ‚ïê‚ïê -->
<div class="header">
  <div class="header-logo">‚ö° WATT<span>WISE</span></div>
  <div class="header-badge">
    <span class="dot" id="sdot"></span>
    <span id="stxt">Texas Live</span>
  </div>
</div>

<!-- ‚ïê‚ïê TABS ‚ïê‚ïê -->
<div class="tabs" id="tabs">
  <div class="tab active" data-tab="search"><i>üîç</i>Search</div>
  <div class="tab" data-tab="history"><i>üìä</i>History</div>
  <div class="tab" data-tab="alerts"><i>üîî</i>Alerts</div>
  <div class="tab" data-tab="about"><i>‚òï</i>About</div>
  <div class="tab" data-tab="settings"><i>‚öôÔ∏è</i>Settings</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SEARCH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel active" id="panel-search">

  <div class="hero">
    <div class="hero-eyebrow">‚ö° Texas Deregulated Energy</div>
    <div class="hero-title">FIND YOUR<br><em>SAVINGS</em></div>
    <div class="hero-sub">Compare every plan in your ZIP. No email, no ads, no kickbacks from providers.</div>
    <div class="zip-row">
      <input type="tel" class="zip-input" id="zip-input" maxlength="5"
        placeholder="ZIP CODE" inputmode="numeric" pattern="[0-9]*"
        oninput="this.value=this.value.replace(/\D/g,'')"
        onkeydown="if(event.key==='Enter')doSearch()">
      <button class="btn btn-primary" onclick="doSearch()">‚ö° Go</button>
    </div>

    <!-- Searching overlay -->
    <div id="searching-overlay">
      <div class="spinner"></div>
      <div class="searching-label" id="slabel">Scanning 75024‚Ä¶</div>
      <div class="searching-sub" id="scount">Comparing plans‚Ä¶</div>
    </div>
  </div>

  <!-- Results -->
  <div id="savings-result">

    <div class="polr-banner">
      ‚ö†Ô∏è The default utility rate in your area is <strong id="polr-lbl">14.2¬¢/kWh</strong>. Most Texans are on this and don't know it.
    </div>

    <div class="savings-hero">
      <div class="savings-eyebrow">You could be overpaying</div>
      <div class="savings-amount" id="savings-num">$580</div>
      <div class="savings-period">per year ¬∑ based on <span id="usage-lbl">1,000</span> kWh/mo</div>
      <div class="rate-row">
        <div class="rate-chip good">
          <div class="rv" id="best-rate">9.4¬¢</div>
          <div class="rl">Best Rate</div>
        </div>
        <div class="arrow-sep">‚Üí</div>
        <div class="rate-chip bad">
          <div class="rv" id="your-rate">14.2¬¢</div>
          <div class="rl">Your Rate</div>
        </div>
      </div>
      <div class="location-label" id="loc-lbl">ZIP 75024 ¬∑ Plano, TX ¬∑ Oncor territory</div>
    </div>

    <div class="section-label">‚ö° Top Plans Available Now</div>
    <div id="plan-cards"></div>

    <!-- Coffee Jar -->
    <div id="tip-jar">
      <div class="tip-hd">
        <div class="tip-hd-eyebrow">‚òï Ad-Free ¬∑ No Kickbacks ¬∑ Solo Developer</div>
        <div class="tip-hd-title">Keep WattWise Running?</div>
      </div>
      <div class="tip-body">
        <div class="tip-copy">
          I'm a neighbor who built this because I was tired of watching Texans overpay.
          I take <strong>zero money from energy companies</strong> and run zero ads.
          If I just found you <strong id="tip-savings">$580 in savings</strong>,
          consider buying me a coffee to keep the servers on. ‚òï
        </div>
        <div class="tip-tiers">
          <button class="tier" onclick="doTip('small_drip',3)">
            <span class="tier-icon">‚òï</span>
            <div class="tier-amt">$3</div>
            <div class="tier-lbl">Small Drip</div>
          </button>
          <button class="tier pop" onclick="doTip('coffee_pastry',7)">
            <div class="tier-badge">‚≠ê Popular</div>
            <span class="tier-icon">ü•ê</span>
            <div class="tier-amt">$7</div>
            <div class="tier-lbl">Coffee &amp; Pastry</div>
          </button>
          <button class="tier" onclick="doTip('energy_hero',15)">
            <span class="tier-icon">‚ö°</span>
            <div class="tier-amt">$15</div>
            <div class="tier-lbl">Energy Hero</div>
          </button>
        </div>
        <div class="tip-dismiss">
          <button onclick="document.getElementById('tip-jar').style.display='none'">
            No thanks, I'll keep overpaying
          </button>
        </div>
      </div>
    </div>

    <!-- Thanks -->
    <div id="tip-thanks">
      <span class="thanks-icon">üôå</span>
      <div class="thanks-title">You're a Texas Legend.</div>
      <div class="thanks-body" id="thanks-msg">Thank you ‚Äî that keeps the site free for every neighbor in Texas.</div>
      <button class="btn btn-outline btn-sm mt2" onclick="document.getElementById('tip-thanks').style.display='none'">Close</button>
    </div>

  </div><!-- /savings-result -->
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HISTORY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-history">
  <div class="card">
    <div class="between" style="margin-bottom:14px">
      <div>
        <div class="bold" id="hist-zip-lbl">No ZIP searched yet</div>
        <div class="sub">30-day rate trend</div>
      </div>
      <button class="btn btn-outline btn-sm" onclick="switchTab('search')">Search ZIP</button>
    </div>
    <div id="hist-table">
      <div class="empty"><span class="empty-icon">üìä</span>Search a ZIP first</div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">üóÇ Saved ZIPs</div>
    <div id="saved-zips">
      <div class="empty" style="padding:12px 0"><span class="sub">Your searched ZIPs will appear here</span></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ALERTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-alerts">
  <div class="card">
    <div class="card-title">üîî Create a Rate Alert</div>
    <div class="input-wrap">
      <label class="input-lbl">ZIP Code</label>
      <input type="tel" class="field" id="al-zip" maxlength="5" placeholder="75024" inputmode="numeric" oninput="this.value=this.value.replace(/\D/g,'')">
    </div>
    <div class="input-wrap">
      <label class="input-lbl">Alert me when rate drops below (¬¢/kWh)</label>
      <input type="number" class="field" id="al-thresh" placeholder="10.0" step="0.1" min="5" max="25">
    </div>
    <div class="input-wrap">
      <label class="input-lbl">Your Email</label>
      <input type="email" class="field" id="al-email" placeholder="you@example.com">
    </div>
    <button class="btn btn-primary btn-full mt1" onclick="saveAlert()">üîî Set Alert</button>
  </div>

  <div class="card">
    <div class="card-title">Active Alerts</div>
    <div id="alerts-list">
      <div class="empty" style="padding:10px 0"><span class="sub">No alerts yet</span></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ABOUT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-about">
  <div class="about-hero">
    <span class="about-icon">‚òï</span>
    <div class="about-title">THE COFFEE<br><em>FUND</em></div>
    <div class="about-sub">WattWise is built by a solo developer in Texas. No ads, no affiliate links, no sponsored results ‚Äî ever.</div>
  </div>

  <div class="card">
    <div class="card-title">How This Works</div>
    <p class="prose">
      Every morning, WattWise pulls the latest rates from
      <strong>PowerToChoose.org</strong> ‚Äî the official Texas PUC comparison site ‚Äî
      and stores them by ZIP code. When you search, you're seeing today's actual
      available rates ranked by real effective price at 1,000 kWh/month
      (not teaser rates designed to mislead you).
    </p>
    <div class="divider"></div>
    <p class="prose">
      Your savings number is calculated by comparing the best available fixed
      12-month rate against your TDU's <strong>POLR (Provider of Last Resort)</strong> rate ‚Äî
      the default rate you're on if you've never switched or your contract expired.
    </p>
    <div class="divider"></div>
    <p class="prose">
      The <strong style="color:#F59E0B">EFL (Electricity Facts Label)</strong> linked on each plan
      is the official PUC document with the real price breakdown. Always read it before switching.
    </p>
  </div>

  <div class="card" style="background:linear-gradient(145deg,#1a1208,#1c1508);border-color:rgba(245,158,11,0.2)">
    <div class="card-title">Support This Tool</div>
    <p class="tip-copy" style="margin-bottom:16px">
      If WattWise saved you money, consider buying me a coffee. Completely voluntary ‚Äî the site is always free.
    </p>
    <div class="tip-tiers">
      <button class="tier" onclick="doTip('small_drip',3)">
        <span class="tier-icon">‚òï</span>
        <div class="tier-amt">$3</div>
        <div class="tier-lbl">Small Drip</div>
      </button>
      <button class="tier pop" onclick="doTip('coffee_pastry',7)">
        <div class="tier-badge">‚≠ê Popular</div>
        <span class="tier-icon">ü•ê</span>
        <div class="tier-amt">$7</div>
        <div class="tier-lbl">Coffee &amp; Pastry</div>
      </button>
      <button class="tier" onclick="doTip('energy_hero',15)">
        <span class="tier-icon">‚ö°</span>
        <div class="tier-amt">$15</div>
        <div class="tier-lbl">Energy Hero</div>
      </button>
    </div>
  </div>

  <div class="card">
    <div class="card-title">Share With Neighbors</div>
    <p class="sub" style="margin-bottom:14px;line-height:1.6">Post in your neighborhood Facebook group or Nextdoor ‚Äî your neighbors will thank you.</p>
    <button class="btn btn-outline btn-full" style="margin-bottom:10px" onclick="doShare()">üì£ Share to Nextdoor / Facebook</button>
    <button class="btn btn-outline btn-full" onclick="copyMsg()">üìã Copy Neighborly Message</button>
  </div>

  <div class="footer-note">
    WattWise v1.0 ¬∑ Not affiliated with any energy company<br>
    Data from PowerToChoose.org ¬∑ PUC-regulated rates
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="panel" id="panel-settings">
  <div class="card">
    <div class="card-title">‚òÅÔ∏è Supabase Connection</div>
    <div class="input-wrap">
      <label class="input-lbl">Project URL</label>
      <input type="url" class="field" id="sb-url" placeholder="https://xxxx.supabase.co">
    </div>
    <div class="input-wrap">
      <label class="input-lbl">Anon Key</label>
      <input type="password" class="field" id="sb-key" placeholder="eyJh‚Ä¶">
    </div>
    <button class="btn btn-primary btn-sm mt1" onclick="saveSupabase()">üíæ Save &amp; Connect</button>
    <div class="sub mt1" id="sb-status">Not connected</div>
  </div>

  <div class="card">
    <div class="card-title">‚öôÔ∏è Preferences</div>
    <div class="setting-row">
      <div>
        <div class="setting-lbl">Monthly Usage (kWh)</div>
        <div class="setting-sub">Used to calculate savings</div>
      </div>
      <input type="number" class="field field-sm" id="pref-usage" value="1000" min="200" max="5000" step="100">
    </div>
    <div class="setting-row">
      <div>
        <div class="setting-lbl">Default ZIP</div>
        <div class="setting-sub">Pre-fill on open</div>
      </div>
      <input type="tel" class="field field-sm" id="pref-zip" maxlength="5" placeholder="75024" inputmode="numeric" oninput="this.value=this.value.replace(/\D/g,'')">
    </div>
    <button class="btn btn-primary btn-sm mt2" onclick="savePrefs()">üíæ Save</button>
  </div>

  <div class="card">
    <div class="card-title">üíæ Data</div>
    <button class="btn btn-outline btn-full" style="margin-bottom:10px" onclick="exportData()">üì§ Export My Data (JSON)</button>
    <button class="btn btn-outline btn-full btn-danger" onclick="clearData()">üóëÔ∏è Clear All Local Data</button>
  </div>

  <div class="footer-note">‚ö° WattWise ¬∑ Texas Deregulated Energy Market<br>Data from PowerToChoose.org</div>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê JS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
'use strict';

// ‚îÄ‚îÄ SUPABASE (lazy init) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let SB = null;
function initSB() {
  const url = ls('ww_sb_url'), key = ls('ww_sb_key');
  if (url && key && typeof supabase !== 'undefined') {
    try {
      SB = supabase.createClient(url, key);
      byId('sb-url').value = url;
      byId('sb-key').value = key;
      byId('sb-status').textContent = '‚úÖ Connected';
      byId('sb-status').style.color = '#10B981';
    } catch(e) { console.warn('SB init', e); }
  }
}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const byId = id => document.getElementById(id);
const ls   = key => localStorage.getItem(key) || '';
const lss  = (k,v) => localStorage.setItem(k,v);

function toast(msg, ms=2800) {
  const t = byId('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), ms);
}

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(name) {
  document.querySelectorAll('.tab').forEach(t =>
    t.classList.toggle('active', t.dataset.tab === name));
  document.querySelectorAll('.panel').forEach(p =>
    p.classList.toggle('active', p.id === 'panel-' + name));
}
document.getElementById('tabs').addEventListener('click', e => {
  const t = e.target.closest('.tab');
  if (t) switchTab(t.dataset.tab);
});

// ‚îÄ‚îÄ TEXAS DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TDU_MAP = {
  '750':'Oncor','751':'Oncor','752':'Oncor','753':'Oncor','754':'Oncor',
  '755':'Oncor','756':'Oncor','757':'Oncor','758':'Oncor','759':'Oncor',
  '760':'Oncor','761':'Oncor','762':'Oncor','763':'Oncor','764':'Oncor',
  '765':'Oncor','766':'Oncor','767':'Oncor','768':'Oncor','769':'Oncor',
  '770':'CenterPoint','771':'CenterPoint','772':'CenterPoint','773':'CenterPoint',
  '774':'CenterPoint','775':'CenterPoint','776':'CenterPoint','777':'CenterPoint',
  '778':'CenterPoint','779':'CenterPoint',
  '780':'AEP Texas','781':'AEP Texas','782':'AEP Texas','783':'AEP Texas',
  '784':'AEP Texas','785':'AEP Texas','786':'AEP Texas','787':'AEP Texas',
  '788':'AEP Texas','789':'AEP Texas','790':'AEP Texas','791':'AEP Texas',
  '792':'AEP Texas','793':'AEP Texas','794':'AEP Texas','795':'AEP Texas',
  '796':'AEP Texas','797':'AEP Texas','798':'AEP Texas','799':'AEP Texas',
};
const POLR  = { 'Oncor':14.2, 'CenterPoint':13.8, 'AEP Texas':15.1, 'TNMP':14.6 };
const CITIES = {
  '750':'Dallas','751':'Dallas','752':'Dallas','753':'Dallas','754':'Corsicana',
  '755':'Palestine','756':'Longview','757':'Tyler','758':'Palestine','759':'Lufkin',
  '760':'Fort Worth','761':'Fort Worth','762':'Weatherford','763':'Waco','764':'Waco',
  '765':'Waco','766':'Waco','767':'Dallas','768':'Abilene','769':'Midland',
  '770':'Houston','771':'Houston','772':'Houston','773':'Houston','774':'Houston',
  '775':'Houston','776':'Beaumont','777':'Beaumont','778':'Bryan','779':'Victoria',
  '780':'San Antonio','781':'San Antonio','782':'San Antonio','783':'Corpus Christi',
  '784':'Corpus Christi','785':'McAllen','786':'Austin','787':'Austin',
  '788':'Del Rio','789':'Uvalde','790':'Amarillo','791':'Amarillo',
  '792':'Childress','793':'Lubbock','794':'Lubbock','795':'Abilene',
  '796':'Abilene','797':'Midland','798':'El Paso','799':'El Paso',
};
const PROVIDERS = [
  {n:'Gexa Energy',    plan:'Gexa Eco Saver 12',   green:true},
  {n:'4Change Energy', plan:'Simply Low 12',        green:true},
  {n:'Pulse Power',    plan:'Pulse Fixed 12',       green:false},
  {n:'Cirro Energy',   plan:'Cirro Saver 12',       green:false},
  {n:'TXU Energy',     plan:'TXU Simple Rate 12',   green:false},
];

function getTDU(z)  { return TDU_MAP[z.slice(0,3)] || 'Oncor'; }
function getCity(z) { return CITIES[z.slice(0,3)]  || 'Texas'; }

function genPlans(bestRate, zip) {
  return PROVIDERS.slice(0,3).map((p,i) => ({
    rank: i+1,
    provider: p.n,
    name: p.plan,
    green: p.green,
    rate: (bestRate + i*0.4).toFixed(1),
    term: 12,
    cancelFee: i===0 ? 0 : 150,
    eflUrl: `https://www.powertochoose.org/en/plans?zip=${zip}`,
  }));
}

// ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentData = null;

async function doSearch() {
  const zip = byId('zip-input').value.trim();
  if (zip.length !== 5) { toast('‚ö†Ô∏è Enter a 5-digit ZIP'); return; }

  const tdu   = getTDU(zip);
  const city  = getCity(zip);
  const polr  = POLR[tdu] || 14.2;
  const usage = parseInt(ls('ww_usage') || '1000');

  // Reset UI
  byId('savings-result').style.display = 'none';
  byId('tip-jar').style.display        = 'none';
  byId('tip-thanks').style.display     = 'none';

  // Show spinner
  const ov = byId('searching-overlay');
  ov.style.display = 'block';
  byId('slabel').textContent = `Scanning ${zip}‚Ä¶`;

  let n = 0;
  const iv = setInterval(() => {
    n = Math.min(n + Math.floor(Math.random()*5)+2, 44);
    byId('scount').textContent = `Comparing ${n} plans from all providers`;
  }, 100);

  // Simulate API (replace with real Supabase query below)
  await new Promise(r => setTimeout(r, 1800 + Math.random()*500));
  clearInterval(iv);

  /* ‚îÄ‚îÄ REAL SUPABASE QUERY (uncomment once DB is populated) ‚îÄ‚îÄ
  if (SB) {
    const { data } = await SB
      .from('v_top3_plans_by_zip')
      .select('*')
      .eq('zip', zip)
      .order('effective_rate', { ascending: true })
      .limit(3);
    // use data here instead of genPlans
  }
  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */

  const bestRate    = polr - (3.2 + Math.random()*1.8);
  const plans       = genPlans(bestRate, zip);
  const annualSave  = Math.round((polr - bestRate) * usage * 12 / 100);

  currentData = { zip, city, tdu, polr, bestRate, annualSave, plans, usage };
  saveHistory(zip, city, annualSave);

  ov.style.display = 'none';
  renderResults(currentData);
  boom();
  setTimeout(() => {
    byId('tip-jar').style.display = 'block';
    byId('tip-savings').textContent = `$${annualSave} in savings`;
    byId('tip-jar').scrollIntoView({ behavior:'smooth', block:'nearest' });
  }, 1200);
}

function renderResults(d) {
  byId('polr-lbl').textContent    = `${d.polr.toFixed(1)}¬¢/kWh`;
  byId('savings-num').textContent = `$${d.annualSave.toLocaleString()}`;
  byId('best-rate').textContent   = `${d.bestRate.toFixed(1)}¬¢`;
  byId('your-rate').textContent   = `${d.polr.toFixed(1)}¬¢`;
  byId('usage-lbl').textContent   = d.usage.toLocaleString();
  byId('loc-lbl').textContent     = `ZIP ${d.zip} ¬∑ ${d.city}, TX ¬∑ ${d.tdu} territory`;
  byId('hist-zip-lbl').textContent = `ZIP ${d.zip} ¬∑ ${d.city}`;

  byId('plan-cards').innerHTML = d.plans.map(p => `
    <div class="plan-card">
      <div class="rank-badge ${p.rank===1?'top':''}">#${p.rank}</div>
      <div class="plan-info">
        <div class="plan-prov">${p.provider}</div>
        <div class="plan-name">${p.name}</div>
        <div class="plan-tags">
          <span class="tag">${p.term} mo</span>
          ${p.green ? '<span class="tag green">üå± Renewable</span>' : ''}
          <span class="tag">${p.cancelFee===0?'No cancel fee':'$'+p.cancelFee+' cancel fee'}</span>
        </div>
        <a href="${p.eflUrl}" target="_blank" class="efl-link">üìÑ Download EFL ‚Üí</a>
      </div>
      <div class="plan-rate-col">
        <div class="plan-rate">${p.rate}¬¢</div>
        <div class="plan-rate-sub">per kWh</div>
      </div>
    </div>
  `).join('');

  byId('savings-result').style.display = 'block';
  renderHistoryTable(d);
}

// ‚îÄ‚îÄ CONFETTI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function boom() {
  if (typeof confetti === 'undefined') return;
  const colors = ['#F59E0B','#EA580C','#FCD34D','#10B981','#E8EDF5'];
  [[0.25,{spread:26,startVelocity:55}],[0.2,{spread:60}],
   [0.35,{spread:100,decay:0.91,scalar:0.8}],[0.1,{spread:120,startVelocity:25}]]
  .forEach(([r,o]) => confetti({particleCount:Math.floor(160*r),origin:{y:0.55},colors,...o}));
}

// ‚îÄ‚îÄ HISTORY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveHistory(zip, city, savings) {
  let h = JSON.parse(ls('ww_hist') || '[]').filter(x => x.zip !== zip);
  h.unshift({ zip, city, savings, date: new Date().toLocaleDateString() });
  lss('ww_hist', JSON.stringify(h.slice(0,10)));
  renderSavedZips();
}

function renderSavedZips() {
  const h = JSON.parse(ls('ww_hist') || '[]');
  byId('saved-zips').innerHTML = h.length
    ? h.map(x => `
        <div class="history-item" onclick="byId('zip-input').value='${x.zip}';switchTab('search');doSearch()">
          <div><div class="bold">${x.zip} ¬∑ ${x.city}</div><div class="sub">${x.date}</div></div>
          <div class="amber bold">Save $${x.savings}/yr</div>
        </div>`).join('')
    : '<div class="empty" style="padding:10px 0"><span class="sub">Your searched ZIPs appear here</span></div>';
}

function renderHistoryTable(d) {
  const rows = Array.from({length:7},(_,i) => {
    const dt = new Date(); dt.setDate(dt.getDate()-6+i);
    const r  = (d.bestRate+(Math.random()-.5)*.5).toFixed(2);
    const s  = Math.round((d.polr-parseFloat(r))*d.usage*12/100);
    return `<tr>
      <td>${dt.toLocaleDateString('en-US',{month:'short',day:'numeric'})}</td>
      <td class="rv-cell">${r}¬¢</td>
      <td class="red-cell">${d.polr.toFixed(1)}¬¢</td>
      <td class="green-cell">$${s}/yr</td>
    </tr>`;
  });
  byId('hist-table').innerHTML = `
    <table class="rate-table">
      <thead><tr><th>Date</th><th>Best Rate</th><th>POLR</th><th>Savings</th></tr></thead>
      <tbody>${rows.join('')}</tbody>
    </table>`;
}

// ‚îÄ‚îÄ TIP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TIP_MSGS = {
  small_drip:    "That covers one day of server time. Every bit helps ‚Äî thank you!",
  coffee_pastry: "That covers a full week online. You're a real one. Thank you!",
  energy_hero:   "Texas-sized generosity! That covers almost a month of hosting. Legend.",
};
function doTip(tier, amt) {
  if (SB && currentData) {
    SB.from('tips').insert({
      zip: currentData.zip, annual_savings: currentData.annualSave,
      tier_label: tier, amount_usd: amt, status: 'pending',
    }).catch(e => console.warn('tip log', e));
  }
  // TODO: replace with your Stripe link
  // window.open('https://buy.stripe.com/YOUR_LINK', '_blank');
  byId('tip-jar').style.display    = 'none';
  byId('tip-thanks').style.display = 'block';
  byId('thanks-msg').textContent   = TIP_MSGS[tier];
  if (typeof confetti !== 'undefined')
    confetti({particleCount:80,spread:60,origin:{y:0.8},colors:['#10B981','#FCD34D','#F59E0B']});
  toast(`‚òï Thank you! $${amt} received`);
  switchTab('search');
}

// ‚îÄ‚îÄ ALERTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveAlert() {
  const zip    = byId('al-zip').value.trim();
  const thresh = parseFloat(byId('al-thresh').value);
  const email  = byId('al-email').value.trim();
  if (zip.length!==5)    { toast('‚ö†Ô∏è Enter a valid ZIP'); return; }
  if (!thresh||thresh<5) { toast('‚ö†Ô∏è Enter a valid threshold'); return; }
  if (!email.includes('@')){ toast('‚ö†Ô∏è Enter a valid email'); return; }
  let alerts = JSON.parse(ls('ww_alerts')||'[]');
  alerts.push({ zip, thresh, email, date: new Date().toLocaleDateString(), id: Date.now() });
  lss('ww_alerts', JSON.stringify(alerts));
  if (SB) SB.from('rate_alerts').insert({zip,threshold_rate:thresh,email,is_active:true}).catch(()=>{});
  renderAlerts();
  toast(`üîî Alert set for ${zip} below ${thresh}¬¢`);
  ['al-zip','al-thresh','al-email'].forEach(id => byId(id).value='');
}

function renderAlerts() {
  const alerts = JSON.parse(ls('ww_alerts')||'[]');
  byId('alerts-list').innerHTML = alerts.length
    ? alerts.map(a => `
        <div class="setting-row">
          <div>
            <div class="bold">ZIP ${a.zip}</div>
            <div class="sub">Below <span class="amber">${a.thresh}¬¢</span> ¬∑ ${a.email}</div>
            <div class="sub">${a.date}</div>
          </div>
          <button class="btn btn-outline btn-sm btn-danger" onclick="delAlert(${a.id})">üóëÔ∏è</button>
        </div>`).join('')
    : '<div class="empty" style="padding:10px 0"><span class="sub">No alerts yet</span></div>';
}

function delAlert(id) {
  let a = JSON.parse(ls('ww_alerts')||'[]').filter(x=>x.id!==id);
  lss('ww_alerts',JSON.stringify(a));
  renderAlerts();
  toast('Alert deleted');
}

// ‚îÄ‚îÄ SHARE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function doShare() {
  const zip  = currentData?.zip  || '75024';
  const city = currentData?.city || 'your area';
  const save = currentData?.annualSave || 500;
  const rate = currentData?.bestRate?.toFixed(1) || '9.4';
  const url  = `https://24kr97gsxq-prog.github.io/Wattwise/`;
  const text = `üì£ ${city} neighbors ‚Äî are you overpaying for electricity?\n\nBest rate in ${zip} right now: ${rate}¬¢/kWh vs the default ${POLR[getTDU(zip)]||14.2}¬¢ ‚Äî that's ~$${save}/year difference.\n\nFree comparison tool, no email, no ads, no kickbacks:\nüëâ ${url}`;
  if (navigator.share) navigator.share({title:'WattWise',text,url});
  else navigator.clipboard.writeText(text).then(()=>toast('‚úÖ Copied!'));
}

function copyMsg() {
  const city = currentData?.city || 'your city';
  const save = currentData?.annualSave || 500;
  const url  = `https://24kr97gsxq-prog.github.io/Wattwise/`;
  const msg  = `Hey neighbors ‚Äî I found a free tool that shows if you're overpaying for electricity in ${city}.\n\nNo email, no ads, the developer takes zero kickbacks from energy companies. Just type your ZIP.\n\nI saved ~$${save}/year.\nüëâ ${url}`;
  navigator.clipboard.writeText(msg).then(()=>toast('‚úÖ Neighborly message copied!'));
}

// ‚îÄ‚îÄ SETTINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveSupabase() {
  const url = byId('sb-url').value.trim(), key = byId('sb-key').value.trim();
  if (!url||!key) { toast('‚ö†Ô∏è Enter both URL and key'); return; }
  lss('ww_sb_url',url); lss('ww_sb_key',key);
  if (typeof supabase !== 'undefined') {
    SB = supabase.createClient(url,key);
    byId('sb-status').textContent = '‚úÖ Connected';
    byId('sb-status').style.color = '#10B981';
    toast('‚úÖ Supabase connected!');
  } else {
    toast('‚ö†Ô∏è Supabase library not loaded ‚Äî credentials saved, refresh to connect');
  }
}

function savePrefs() {
  lss('ww_usage', byId('pref-usage').value || '1000');
  lss('ww_defzip', byId('pref-zip').value.trim());
  toast('‚úÖ Preferences saved');
}

function exportData() {
  const d = {
    history: JSON.parse(ls('ww_hist')||'[]'),
    alerts:  JSON.parse(ls('ww_alerts')||'[]'),
    prefs:   { usage: ls('ww_usage'), defaultZip: ls('ww_defzip') },
    exported: new Date().toISOString(),
  };
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([JSON.stringify(d,null,2)],{type:'application/json'}));
  a.download = `wattwise-${Date.now()}.json`;
  a.click();
}

function clearData() {
  if (!confirm('Clear all local data?')) return;
  ['ww_hist','ww_alerts','ww_usage','ww_defzip'].forEach(k=>localStorage.removeItem(k));
  toast('üóëÔ∏è Cleared'); renderSavedZips(); renderAlerts();
}

// ‚îÄ‚îÄ ONLINE STATUS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateStatus() {
  const on = navigator.onLine;
  byId('sdot').className = 'dot' + (on?'':' off');
  byId('stxt').textContent = on ? 'Texas Live' : 'Offline';
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', () => {
  initSB();
  const defZip = ls('ww_defzip');
  if (defZip) byId('zip-input').value = defZip;
  byId('pref-usage').value = ls('ww_usage') || '1000';
  byId('pref-zip').value   = ls('ww_defzip') || '';
  renderSavedZips();
  renderAlerts();
  window.addEventListener('online',  updateStatus);
  window.addEventListener('offline', updateStatus);
  updateStatus();
});
</script>

<!-- Supabase CDN (loads async, app works without it) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
<!-- Confetti CDN -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js" defer></script>

</body>
</html>
