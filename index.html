<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WattWise Gratuity ‚Äî Free Texas Electricity Savings</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=JetBrains+Mono:wght@400;500;600;700&family=Source+Serif+4:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--g:#00DC82;--gd:#00b368;--y:#FACC15;--b:#38BDF8;--r:#ff6b6b;--o:#FB923C;--fd:'Playfair Display',Georgia,serif;--fm:'JetBrains Mono',monospace;--fb:'Source Serif 4',Georgia,serif}
html{scroll-behavior:smooth}
body{min-height:100vh;background:linear-gradient(165deg,#0a0a12,#0d0d1a 40%,#0a1a12);color:#c8c8d0;font-family:var(--fb);-webkit-font-smoothing:antialiased}
input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{-webkit-appearance:none}input[type=number]{-moz-appearance:textfield}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-thumb{background:rgba(0,220,130,.2);border-radius:3px}
button{font-family:inherit;border:none;cursor:pointer}

@keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
@keyframes confetti{0%{opacity:1;transform:translateY(0) rotate(0)}100%{opacity:0;transform:translateY(100vh) rotate(720deg)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
@keyframes barGrow{from{width:0}}
@keyframes glow{0%,100%{box-shadow:0 0 20px rgba(0,220,130,.1)}50%{box-shadow:0 0 40px rgba(0,220,130,.25)}}
@keyframes slideUp{from{opacity:0;transform:translateY(30px) scale(.97)}to{opacity:1;transform:translateY(0) scale(1)}}
@keyframes checkPop{0%{transform:scale(0)}60%{transform:scale(1.2)}100%{transform:scale(1)}}
.fu{animation:fadeUp .6s ease-out both}
.confetti-p{position:fixed;top:-20px;z-index:9999;pointer-events:none}

/* === HEADER === */
.hdr{padding:18px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.04)}
.logo{display:flex;align-items:center;gap:10px}
.logo-i{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,var(‚Äìg),var(‚Äìgd));display:flex;align-items:center;justify-content:center;font-size:17px;font-weight:700;color:#0a0a0a}
.logo-t{font-family:var(‚Äìfd);font-size:17px;font-weight:700;color:#fff;line-height:1}
.logo-s{font-size:8px;letter-spacing:2.5px;text-transform:uppercase;color:var(‚Äìg);font-family:var(‚Äìfm)}
.hdr-b{display:flex;gap:8px;align-items:center}
.btn-gh{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);color:#a0a0b0;border-radius:8px;padding:7px 12px;font-size:11px;font-family:var(‚Äìfm);transition:all .2s}
.btn-gh:hover{background:rgba(255,255,255,.07);color:#fff}
.btn-tp{background:linear-gradient(135deg,var(‚Äìg),var(‚Äìgd));color:#0a0a0a;border-radius:8px;padding:7px 12px;font-size:11px;font-weight:700;font-family:var(‚Äìfm);animation:float 3s ease-in-out infinite;display:none}
.btn-tp.vis{display:inline-block}

/* === HERO === */
.hero{padding:56px 20px 36px;text-align:center;max-width:640px;margin:0 auto}
.hero-tag{font-size:10px;letter-spacing:4px;text-transform:uppercase;color:var(‚Äìg);font-family:var(‚Äìfm);margin-bottom:18px}
.hero h1{font-family:var(‚Äìfd);font-size:clamp(30px,6vw,50px);font-weight:700;color:#fff;line-height:1.1;margin-bottom:18px}
.hero .gr{background:linear-gradient(135deg,var(‚Äìg),var(‚Äìb));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{font-size:16px;line-height:1.7;color:#888;max-width:460px;margin:0 auto 32px}
.hl{color:var(‚Äìg)}

/* === SEARCH === */
.sbox{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:22px;max-width:480px;margin:0 auto}
.srow{display:flex;gap:10px;margin-bottom:12px}.srow .f1{flex:1}.srow .fs{width:130px}
.inp{width:100%;background:rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:13px 15px;color:#fff;font-size:17px;font-family:var(‚Äìfm);outline:none;letter-spacing:2px;transition:border .2s}
.inp:focus{border-color:rgba(0,220,130,.4)}.inp-u{letter-spacing:0}
.btn-s{width:100%;padding:15px;background:linear-gradient(135deg,var(‚Äìg),var(‚Äìgd));color:#0a0a0a;border-radius:12px;font-size:15px;font-weight:700;font-family:var(‚Äìfm);transition:opacity .2s}
.btn-s:hover{opacity:.9}.btn-s:disabled{background:rgba(0,220,130,.3);cursor:default}
.smeta{margin-top:12px;font-size:10px;color:#444;font-family:var(‚Äìfm);text-align:center}
.errmsg{margin-top:12px;padding:10px 14px;background:rgba(255,80,80,.08);border:1px solid rgba(255,80,80,.2);border-radius:8px;font-size:12px;color:#ff8888}
.lb{display:block;font-size:10px;letter-spacing:2px;text-transform:uppercase;color:#666;font-family:var(‚Äìfm);margin-bottom:6px;text-align:left}

/* === CURRENT RATE === */
.crbar{background:linear-gradient(135deg,rgba(255,107,107,.06),rgba(255,107,107,.02));border:1px solid rgba(255,107,107,.15);border-radius:12px;padding:16px 18px;margin-bottom:18px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
.crbar h4{font-size:14px;color:#fff;font-weight:600;margin-bottom:3px}.crbar p{font-size:12px;color:#888}
.cr-inp{display:flex;align-items:center;gap:8px}
.cr-inp label{font-size:11px;color:#aaa;font-family:var(‚Äìfm);white-space:nowrap}
.cr-sm{width:80px;background:rgba(0,0,0,.4);border:1px solid rgba(255,107,107,.25);border-radius:8px;padding:10px;color:#fff;font-size:16px;font-family:var(‚Äìfm);outline:none;text-align:center}

/* === RESULTS === */
.res{padding:0 20px 60px;max-width:720px;margin:0 auto}.res.hid{display:none}
.tbar{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:14px 18px;margin-bottom:18px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
.tbar .nm{font-size:15px;color:#fff;font-weight:600;margin-top:2px}.tbar .rg{font-size:12px;color:#777}
.polr{font-size:20px;color:var(‚Äìr);font-weight:700;font-family:var(‚Äìfm)}
.sgrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(190px,1fr));gap:12px;margin-bottom:22px}
.scard{border-radius:14px;padding:18px 16px;animation:glow 3s ease-in-out infinite}
.scard.grn{background:linear-gradient(135deg,rgba(0,220,130,.08),rgba(0,220,130,.02));border:1px solid rgba(0,220,130,.2)}
.scard.ylw{background:rgba(250,204,21,.04);border:1px solid rgba(250,204,21,.15)}
.scard.blu{background:rgba(56,189,248,.04);border:1px solid rgba(56,189,248,.15)}
.scard .big{font-size:32px;font-weight:700;font-family:var(‚Äìfm);margin-top:6px}
.scard .sub{font-size:12px;color:#888}

/* === COST BARS === */
.ccomp{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:18px;margin-bottom:22px}
.brow{margin-bottom:12px}.brow:last-child{margin-bottom:0}
.bhdr{display:flex;justify-content:space-between;font-size:12px;color:#aaa;margin-bottom:4px}
.bhdr .v{font-family:var(‚Äìfm);font-weight:600}
.btrk{height:8px;background:rgba(255,255,255,.04);border-radius:4px;overflow:hidden}
.bfil{height:100%;border-radius:4px;animation:barGrow .8s ease-out both}

/* === PLAN TABLE === */
.ptbl{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:14px;overflow:hidden;margin-bottom:22px}
.ptbl-h{padding:14px 18px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,.04);flex-wrap:wrap;gap:10px}
.ptbl-h h3{font-size:16px;font-weight:600;color:#fff}.ptbl-h .sub{font-size:11px;color:#666}
.sortb{display:flex;gap:5px;flex-wrap:wrap}
.sbtn{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);color:#777;border-radius:6px;padding:4px 9px;font-size:9px;font-family:var(‚Äìfm);text-transform:uppercase;letter-spacing:1px;transition:all .15s}
.sbtn.a{background:rgba(0,220,130,.15);border-color:rgba(0,220,130,.3);color:var(‚Äìg)}

/* Plan Rows */
.prow{padding:15px 18px;border-bottom:1px solid rgba(255,255,255,.03);transition:background .15s}
.prow:hover{background:rgba(255,255,255,.015)}.prow.best{background:rgba(0,220,130,.03)}
.prow-top{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap}
.pinf{flex:1;min-width:180px}
.pprov{font-size:14px;font-weight:600;color:#fff}
.pbdg{display:inline-flex;gap:5px;margin-left:8px;vertical-align:middle}
.bdg{font-size:8px;padding:2px 7px;border-radius:4px;font-family:var(‚Äìfm);letter-spacing:1px;text-transform:uppercase;font-weight:700}
.bdg-b{background:rgba(0,220,130,.15);color:var(‚Äìg)}.bdg-g{background:rgba(56,189,248,.1);color:var(‚Äìb)}
.pname{font-size:12px;color:#888;margin-top:2px}
.pmeta{margin-top:4px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;font-size:11px;color:#555}
.stars{display:inline-flex;gap:1px;align-items:center}.star{font-size:11px}.star.on{color:var(‚Äìy)}.star.hlf{color:var(‚Äìy);opacity:.5}.star.off{color:#3a3a3a;opacity:.3}
.star-n{font-size:10px;color:#888;margin-left:3px}
.pprc{text-align:right;min-width:110px}
.prate{font-size:22px;font-weight:700;font-family:var(‚Äìfm);color:#fff}.prate.br{color:var(‚Äìg)}
.pmo{font-size:11px;color:#777}.psav{font-size:11px;color:var(‚Äìg);font-weight:600;margin-top:2px}

/* Plan select row */
.psel{margin-top:10px;display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
.psel-info{font-size:11px;color:#aaa;font-family:var(‚Äìfm)}
.psel-info .amt{color:var(‚Äìg);font-weight:700;font-size:13px}
.btn-sel{background:rgba(0,220,130,.1);border:1px solid rgba(0,220,130,.25);color:var(‚Äìg);border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;font-family:var(‚Äìfm);transition:all .2s;white-space:nowrap}
.btn-sel:hover{background:rgba(0,220,130,.2);border-color:rgba(0,220,130,.4);color:#fff}
.btn-all{width:100%;padding:13px;background:rgba(255,255,255,.02);color:var(‚Äìg);font-size:12px;font-family:var(‚Äìfm);border-top:1px solid rgba(255,255,255,.04)}

/* === TIP CTA === */
.tcta{background:linear-gradient(135deg,rgba(0,220,130,.06),rgba(250,204,21,.04));border:1px solid rgba(0,220,130,.15);border-radius:16px;padding:28px 22px;text-align:center;margin-bottom:20px}
.tcta .emo{font-size:32px;margin-bottom:10px}
.tcta h3{font-family:var(‚Äìfd);font-size:21px;color:#fff;margin-bottom:8px}
.tcta p{font-size:13px;color:#888;line-height:1.6;max-width:400px;margin:0 auto 18px}
.btn-cta{background:linear-gradient(135deg,var(‚Äìg),var(‚Äìgd));color:#0a0a0a;border-radius:12px;padding:13px 36px;font-size:15px;font-weight:700;font-family:var(‚Äìfm)}
.btn-cta:hover{opacity:.9}

/* Share */
.share{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:14px;padding:18px;margin-bottom:22px}
.share p{font-size:13px;color:#888;line-height:1.6;margin-bottom:12px}
.shtxt{background:rgba(0,0,0,.3);border-radius:10px;padding:14px;font-size:13px;color:#c8c8d0;line-height:1.6;border:1px solid rgba(255,255,255,.04);position:relative}
.btn-cp{position:absolute;top:10px;right:10px;background:rgba(0,220,130,.15);border:1px solid rgba(0,220,130,.3);color:var(‚Äìg);border-radius:6px;padding:4px 10px;font-size:10px;font-family:var(‚Äìfm)}

/* === MODALS === */
.ov{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:10000;display:none;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
.ov.open{display:flex}
.mdl{background:linear-gradient(165deg,#1a1a2e,#0f0f1a 50%,#1a0f2e);border:1px solid rgba(0,220,130,.2);border-radius:20px;max-height:85vh;overflow:hidden;box-shadow:0 25px 80px rgba(0,220,130,.15);display:flex;flex-direction:column}
.mdl-x{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);color:#aaa;border-radius:50%;width:32px;height:32px;font-size:18px;display:flex;align-items:center;justify-content:center}
.mdl-x:hover{background:rgba(255,255,255,.1);color:#fff}

/* Story */
.st-mdl{max-width:660px;width:100%;padding:0;overflow:hidden;display:flex;flex-direction:column}
.st-mdl h2{font-family:var(‚Äìfd);font-size:28px;color:#fff;line-height:1.2;margin:0 0 22px}
.stbdy{font-size:15px;line-height:1.85;color:#c8c8d0}.stbdy p{margin-bottom:18px}
.stbdy strong{color:#fff}.stbdy .yel{color:var(‚Äìy)}
.stq{border-left:3px solid var(‚Äìg);padding-left:18px;margin:24px 0;font-style:italic;color:#e0e0e0;font-size:16px}
.stph{background:rgba(0,220,130,.06);border:1px solid rgba(0,220,130,.15);border-radius:14px;padding:22px 18px;margin:24px 0}
.stph .tt{font-size:12px;color:var(‚Äìg);font-weight:600;margin-bottom:8px;font-family:var(‚Äìfm)}
.stph p{margin:0;color:#e8e8f0}

/* Tip Modal */
.tpmdl{max-width:460px;width:100%;padding:32px 26px;overflow-y:auto;-webkit-overflow-scrolling:touch}
.tpmdl h3{font-family:var(‚Äìfd);font-size:22px;color:#fff;margin:0;line-height:1.2}
.tpsn{background:rgba(0,220,130,.06);border:1px solid rgba(0,220,130,.12);border-radius:10px;padding:11px 14px;margin:18px 0;font-size:13px;color:#a8a8b8}
.tpsn strong{color:var(‚Äìg)}
.tpgrid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin:18px 0}
.tpopt{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:16px 8px;text-align:center;transition:all .2s}
.tpopt:hover{background:rgba(255,255,255,.05)}.tpopt.sel{background:rgba(0,220,130,.15);border-color:rgba(0,220,130,.5)}
.tpopt .emo{font-size:26px;margin-bottom:4px}.tpopt .amt{font-size:19px;font-weight:700;color:#fff;font-family:var(‚Äìfm)}
.tpopt .lbl{font-size:10px;color:var(‚Äìg);font-weight:600;margin-top:3px}.tpopt .dsc{font-size:9px;color:#777;margin-top:1px}
.tpdiv{display:flex;align-items:center;gap:10px;margin:14px 0;font-size:11px;color:#555}
.tpdiv::before,.tpdiv::after{content:‚Äô‚Äô;flex:1;height:1px;background:rgba(255,255,255,.06)}
.tpcw{position:relative;flex:1}.tpc${ position:absolute;left:14px;top:50%;transform:translateY(-50%);color:#666;font-size:16px}
.tpci{width:100%;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:12px 14px 12px 28px;color:#fff;font-size:16px;font-family:var(‚Äìfm);outline:none}
.tpci:focus{border-color:rgba(0,220,130,.4)}.tpci.sel{border-color:rgba(0,220,130,.5)}
.btn-tps{width:100%;margin-top:18px;padding:13px;background:rgba(255,255,255,.05);color:#555;border-radius:12px;font-size:15px;font-weight:700;transition:all .3s}
.btn-tps.act{background:linear-gradient(135deg,var(‚Äìg),var(‚Äìgd));color:#0a0a0a;cursor:pointer}
.tpf{text-align:center;font-size:10px;color:#555;margin-top:12px}
.tpty{text-align:center;max-width:420px;padding:44px 32px}
.tpty .emo{font-size:52px;margin-bottom:14px}
.tpty h3{font-family:var(‚Äìfd);font-size:24px;color:#fff;margin:0 0 10px}
.tpty p{color:#a0a0b0;font-size:14px;line-height:1.6;margin-bottom:22px}
.tpty strong{color:var(‚Äìg)}

/* === REGISTRATION MODAL === */
.rmdl{max-width:560px;width:100%;padding:0;overflow:hidden;display:flex;flex-direction:column;height:100%}
.rstep{display:none;animation:slideUp .4s ease-out}.rstep.act{display:flex;flex-direction:column;flex:1;min-height:0}

/* Step 1 */
.rsh{padding:20px 24px 0}.rsh h3{font-family:var(‚Äìfd);font-size:24px;color:#fff;margin:0 0 4px}
.rpb{display:inline-block;background:rgba(0,220,130,.12);border:1px solid rgba(0,220,130,.25);border-radius:8px;padding:6px 14px;margin-top:8px;font-family:var(‚Äìfm);font-size:12px;color:var(‚Äìg)}
.rsb{padding:16px 24px 8px}
.rs1-sticky{position:sticky;bottom:0;background:linear-gradient(to top,#0f0f1a 70%,transparent);padding:12px 24px 20px;z-index:2}
.rcmp{background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.06);border-radius:14px;overflow:hidden;margin-bottom:16px}
.rcr{display:flex;justify-content:space-between;align-items:center;padding:12px 16px}
.rcr+.rcr{border-top:1px solid rgba(255,255,255,.04)}
.rcl{font-size:13px;color:#aaa}.rcl small{display:block;font-size:10px;color:#666;margin-top:1px;font-family:var(‚Äìfm)}
.rcv{font-family:var(‚Äìfm);font-weight:700;font-size:17px}
.rcr.old .rcv{color:var(‚Äìr);text-decoration:line-through;text-decoration-color:rgba(255,107,107,.4)}
.rcr.new .rcv{color:var(‚Äìg)}
.rcr.sav{background:linear-gradient(135deg,rgba(0,220,130,.08),rgba(250,204,21,.04))}
.rcr.sav .rcv{color:var(‚Äìy);font-size:20px}
.rbkd{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:8px}
.rbk{background:rgba(255,255,255,.02);border:1px solid rgba(255,255,255,.06);border-radius:10px;padding:12px 8px;text-align:center}
.rbk .n{font-size:20px;font-weight:700;font-family:var(‚Äìfm);margin:2px 0}
.rbk .l{font-size:8px;letter-spacing:1.5px;text-transform:uppercase;color:#777;font-family:var(‚Äìfm)}
.rbk.grn .n{color:var(‚Äìg)}.rbk.ylw .n{color:var(‚Äìy)}.rbk.blu .n{color:var(‚Äìb)}
.btn-rn{width:100%;padding:15px;background:linear-gradient(135deg,var(‚Äìg),var(‚Äìgd));color:#0a0a0a;border-radius:12px;font-size:15px;font-weight:700;font-family:var(‚Äìfm)}
.tipnudge{margin:20px 0 10px;text-align:center;position:relative}
.tipnudge-line{height:1px;background:rgba(255,255,255,.06);margin-bottom:16px}
.tipnudge-inner{display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap}
.tipnudge-txt{font-size:12px;color:#666}
.tipnudge-btn{background:none;border:1px solid rgba(250,204,21,.2);color:var(‚Äìy);border-radius:20px;padding:5px 14px;font-size:12px;font-family:var(‚Äìfm);transition:all .2s;white-space:nowrap}
.tipnudge-btn:hover{background:rgba(250,204,21,.08);border-color:rgba(250,204,21,.4)}
.btn-rn:hover{opacity:.9}
.btn-rb{width:100%;padding:12px;background:none;color:#777;font-size:13px;margin-top:8px}

/* Step 2 - Switch page */
.rfb{padding:28px}

/* Admin Panel */
.admdl{max-width:540px;width:100%;overflow:hidden;display:flex;flex-direction:column}
.ad-sec{background:rgba(0,220,130,.03);border:1px solid rgba(0,220,130,.12);border-radius:12px;padding:16px;margin-bottom:14px}
.ad-title{font-size:14px;font-weight:600;color:#fff;margin-bottom:6px}
.ad-desc{font-size:11px;color:#999;line-height:1.5;margin-bottom:12px}
.ad-field{margin-bottom:10px}
.ad-field label{display:block;font-size:10px;letter-spacing:1.2px;text-transform:uppercase;color:rgba(0,220,130,.7);font-family:var(‚Äìfm);margin-bottom:4px;font-weight:600}
.ad-field .rinp{width:100%;background:rgba(0,0,0,.4);border:1px solid rgba(0,220,130,.2);border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;font-family:var(‚Äìfm);outline:none}
.ad-field .rinp:focus{border-color:rgba(0,220,130,.6);box-shadow:0 0 8px rgba(0,220,130,.15)}
.ad-field .rinp::placeholder{color:#666}
.ad-status{font-size:11px;font-family:var(‚Äìfm);padding:8px 12px;border-radius:8px;margin-top:10px}
.ad-status.live{background:rgba(0,220,130,.08);color:var(‚Äìg);border:1px solid rgba(0,220,130,.2)}
.ad-status.demo{background:rgba(250,204,21,.06);color:var(‚Äìy);border:1px solid rgba(250,204,21,.15)}
.ad-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.ad-stat{text-align:center;padding:10px 6px;background:rgba(0,0,0,.2);border-radius:8px}
.ad-stat-n{display:block;font-size:20px;font-weight:700;color:#fff;font-family:var(‚Äìfm)}
.ad-stat-l{font-size:9px;color:#666;text-transform:uppercase;letter-spacing:1px;font-family:var(‚Äìfm)}
.ad-steps{display:flex;flex-direction:column;gap:8px}
.ad-step{display:flex;align-items:center;gap:10px;font-size:12px;color:#aaa}
.ad-step-n{width:22px;height:22px;border-radius:50%;background:rgba(0,220,130,.12);color:var(‚Äìg);font-size:11px;font-weight:700;font-family:var(‚Äìfm);display:flex;align-items:center;justify-content:center;flex-shrink:0}

/* Step 3 */
.rcnf{padding:36px 28px;text-align:center}
.rchk-i{width:64px;height:64px;border-radius:50%;background:linear-gradient(135deg,rgba(0,220,130,.15),rgba(0,220,130,.05));display:flex;align-items:center;justify-content:center;margin:0 auto 18px;animation:checkPop .6s ease-out}
.rchk-i svg{width:32px;height:32px}
.rcnf h3{font-family:var(‚Äìfd);font-size:26px;color:#fff;margin:0 0 10px}
.rcnf .pd{font-size:14px;color:#aaa;margin-bottom:6px}.rcnf .pd strong{color:var(‚Äìg)}
.rcsav{background:rgba(0,220,130,.06);border:1px solid rgba(0,220,130,.15);border-radius:12px;padding:18px;margin:20px 0;text-align:center}
.rcsav .big{font-size:36px;font-weight:700;color:var(‚Äìg);font-family:var(‚Äìfm)}
.rcsav .lbl{font-size:12px;color:#888;margin-top:4px}
.rcns{text-align:left;margin:20px 0}
.rcns h4{font-size:12px;letter-spacing:2px;text-transform:uppercase;color:#666;font-family:var(‚Äìfm);margin-bottom:10px}
.nsi{display:flex;gap:12px;align-items:flex-start;margin-bottom:12px}
.nsn{width:24px;height:24px;border-radius:50%;background:rgba(0,220,130,.12);color:var(‚Äìg);font-size:12px;font-weight:700;font-family:var(‚Äìfm);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.nst{font-size:13px;color:#aaa;line-height:1.5}.nst strong{color:#ddd}
/* Footer */
.ftr{padding:36px 20px;border-top:1px solid rgba(255,255,255,.04);text-align:center;max-width:640px;margin:0 auto}
.ftr p{font-size:12px;color:#444;line-height:1.8}
.ftr .sl{background:none;color:var(‚Äìg);font-size:12px;text-decoration:underline;margin-top:8px;display:inline-block}

@media(max-width:480px){
.srow{flex-direction:column}.srow .fs{width:100%}.sgrid{grid-template-columns:1fr}
.prow-top{flex-direction:column}.pprc{text-align:left;margin-top:8px}
.tbar{flex-direction:column;text-align:left}.tbar>div:last-child{text-align:left}
.crbar{flex-direction:column;align-items:flex-start}
.rbkd{grid-template-columns:1fr 1fr 1fr}
.rsh,.rsb{padding-left:16px;padding-right:16px}
.rs1-sticky{padding-left:16px;padding-right:16px}
.rcnf{padding:24px 16px 20px}
.rsh,.rsb,.rfb{padding-left:20px;padding-right:20px}
.st-mdl{padding:0}.st-mdl h2{font-size:24px}
.ov{padding:0;align-items:stretch;justify-content:stretch}
.mdl{max-height:100vh;max-height:100dvh;height:100%;border-radius:0;margin-top:0;overflow:hidden}
.rmdl{max-width:100%;height:100%}
.mdl-x{width:36px;height:36px;font-size:22px}
.rcnf h3{font-size:22px}
.rcnf .rchk-i{width:44px;height:44px}
.rcns{margin:14px 0}
.nsi{padding:8px 10px;gap:10px}
.nsn{width:22px;height:22px;font-size:11px;flex-shrink:0}
.nst{font-size:13px}
.rcsav{padding:14px;margin:12px 0}
.rcsav .big{font-size:28px}
.btn-rn{padding:14px;font-size:15px}
.tipnudge{margin:14px 0 8px}
}
</style>

</head>
<body>

<header class="hdr">
  <div class="logo"><div class="logo-i">‚ö°</div><div><div class="logo-t">WattWise</div><div class="logo-s">GRATUITY</div></div></div>
  <div class="hdr-b"><button class="btn-gh" onclick="openStory()">Andy's Story</button><button class="btn-tp" id="hTip" onclick="openTip()">‚òï Tip Andy</button></div>
</header>

<section class="hero">
  <div class="hero-tag">FREE TEXAS ENERGY COMPARISON ENGINE</div>
  <h1>Stop Overpaying<br>for <span class="gr">Texas Electricity</span></h1>
  <p>Real rates from <b id="tpCnt">54</b> plans across <b id="tzCnt">300</b>+ ZIP codes. Andy built this so his friends and family would never overpay again. <span class="hl">Always free. Tip only if you want to.</span></p>
  <div class="sbox">
    <div class="srow"><div class="f1"><div class="lb">Texas ZIP Code</div><input type="text" id="zInp" class="inp" placeholder="e.g. 75087" maxlength="5"></div><div class="fs"><div class="lb">Monthly kWh</div><input type="number" id="uInp" class="inp inp-u" value="1000" min="100"></div></div>
    <button class="btn-s" id="sBtn" onclick="doSearch()">Find My Best Rate</button>
    <div id="errM" class="errmsg" style="display:none"></div>
    <div class="smeta">Database: <span id="dbC">54</span> plans ¬∑ Updated <span id="dbDate">Feb 20, 2026</span> ¬∑ <span id="dbSrc">Source: PowerToChoose.org</span></div>
  </div>
</section>

<section class="res hid" id="resSec">
  <div class="tbar fu"><div><div class="lb">Your Service Territory</div><div class="nm" id="tduN"></div><div class="rg" id="tduR"></div></div><div style="text-align:right"><div class="lb">Default Rate (POLR)</div><div class="polr" id="polrR"></div></div></div>

  <div class="crbar fu" style="animation-delay:.06s"><div><h4>What are you paying now?</h4><p>Enter your current rate for personalized savings on every plan</p></div><div class="cr-inp"><label>Your Rate:</label><input type="number" id="crInp" class="cr-sm" placeholder="14.5" step="0.1" min="1" max="50" oninput="updCR()"><span style="font-size:13px;color:#888;font-family:var(--fm)">¬¢/kWh</span></div></div>

  <div class="sgrid">
    <div class="scard grn fu" style="animation-delay:.12s"><div class="lb" style="color:var(--g)">Best Available Rate</div><div class="big" style="color:var(--g)" id="bRate"></div><div class="sub" id="bProv"></div></div>
    <div class="scard ylw fu" style="animation-delay:.18s"><div class="lb" style="color:var(--y)">Monthly Savings</div><div class="big" style="color:var(--y)" id="mSav"></div><div class="sub" id="savLbl">vs default TDU rate</div></div>
    <div class="scard blu fu" style="animation-delay:.24s"><div class="lb" style="color:var(--b)">Annual Savings</div><div class="big" style="color:var(--b)" id="aSav"></div><div class="sub">that's real money back</div></div>
  </div>

  <div class="ccomp fu" style="animation-delay:.3s"><div class="lb" style="margin-bottom:14px">Monthly Cost at <span id="uLbl">1000</span> kWh</div><div id="cBars"></div></div>

  <div class="ptbl fu" style="animation-delay:.36s">
    <div class="ptbl-h"><div><h3 id="ptTitle">Top 5 Plans</h3><div class="sub" id="ptSub">Sorted by rate ¬∑ 1000 kWh/mo</div></div><div class="sortb"><button class="sbtn a" onclick="sSort('rate',this)">Rate</button><button class="sbtn" onclick="sSort('rating',this)">Rating</button><button class="sbtn" onclick="sSort('renewable',this)">Renewable</button><button class="sbtn" onclick="sSort('provider',this)">Provider</button></div></div>
    <div id="pList"></div>
    <button class="btn-all" id="saBtn" onclick="togAll()" style="display:none">Show all plans ‚Üì</button>
  </div>

  <div class="tcta fu" style="animation-delay:.42s"><div class="emo">‚òï</div><h3>Andy just saved you <span class="hl" id="ctaS">$0</span>/year</h3><p>This tool is always free. If you found it helpful, consider buying Andy a coffee.</p><button class="btn-cta" onclick="openTip()">Buy Andy a Coffee ‚òï</button></div>

  <div class="share fu" style="animation-delay:.48s"><div class="lb" style="margin-bottom:10px">Share with Friends & Neighbors</div><p>Know someone in Texas who might be overpaying?</p><div class="shtxt" id="shTxt"><button class="btn-cp" onclick="cpSh()">Copy</button></div></div>
</section>

<footer class="ftr"><p>Rates sourced from PowerToChoose.org & public PUCT filings. Updated Feb 20, 2026.</p><p>Not affiliated with any REP. No affiliate links. No commissions.</p><p style="margin-top:8px">Built with üíö by Andy for his friends, family, and every Texan who deserves a fair rate.</p><button class="sl" onclick="openStory()">Read Andy's Story ‚Üí</button></footer>

<!-- STORY MODAL -->

<div class="ov" id="stOv" onclick="xOv(event,'stOv')"><div class="mdl st-mdl">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;padding:36px 32px 14px;flex-shrink:0"><div class="lb" style="color:var(--g);margin-bottom:0">The Origin Story</div><button class="mdl-x" onclick="xSt()">√ó</button></div>
  <div style="flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;min-height:0;padding:0 32px 36px">
  <h2>How Andy Turned a <span class="hl">Kitchen Table Gripe</span> Into a Movement</h2>
  <div class="stbdy">
    <p>It started the way most good ideas do in Texas ‚Äî over cold beer and a too-high electric bill.</p>
    <p>Andy had just gotten his August bill from one of the big-name retail electric providers. <span class="yel">$387 for a modest three-bedroom in the DFW suburbs.</span> He knew the deregulated market meant he had options, but the PowerToChoose website felt like comparing airline tickets ‚Äî hundreds of plans, confusing "energy facts" labels, and rates that looked great until you read the fine print.</p>
    <p>So Andy did what he always does: he dove in. Nights after putting the kids to bed, he built spreadsheets. He reverse-engineered the PUCT's EFL format. He mapped every ZIP code to its TDU territory. He normalized every rate to true apples-to-apples cost per kWh.</p>
    <div class="stq">"I saved $1,140 the first year just by switching. And I thought ‚Äî if I can do this for myself, why not make it dead simple for everyone I know?"</div>
    <p>Andy started texting neighbors. Then posting in his Nextdoor group. The message was always the same: <strong>"Send me your ZIP code. I'll send you the best rate. Totally free."</strong></p>
    <p>No affiliate links. No commissions. No catch. Within three months, Andy had helped <strong>47 families</strong> switch to better plans, saving them <strong class="yel">$62,000 annually</strong>.</p>
    <p>People kept asking: "Andy, can I pay you for this?" His answer ‚Äî <em>"Nah, just buy me a coffee if you feel like it."</em></p>
    <div class="stph"><div class="tt">THE WATTSWISE PHILOSOPHY</div><p>Give value first. Give it freely. Give it publicly. A voluntary tip after a real savings reveal is worth more than any hard sell. Andy calls it <strong>"The Gratitude Economy."</strong></p></div>
    <p>Andy's mission: <strong style="color:var(--g)">help every Texan in a deregulated zone get the best possible electricity rate, for free.</strong></p>
    <p style="color:#888;font-size:13px">‚Äî The WattWise Team, February 2026</p>
  </div>
</div></div></div>

<!-- TIP MODAL -->

<div class="ov" id="tpOv" onclick="xOv(event,'tpOv')">
  <div class="mdl tpmdl" id="tpSel">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px"><div><div class="lb" style="color:var(--g);margin-bottom:6px">Andy's Coffee Fund</div><h3>Feeling Generous?</h3></div><button class="mdl-x" onclick="xTp()">√ó</button></div>
    <div class="tpsn" id="tpSN" style="display:none">You're saving <strong id="tpSA">$0/year</strong> ‚Äî always free. Tips optional.</div>
    <div class="tpgrid">
      <div class="tpopt" onclick="sTp(3,this)"><div class="emo">‚òï</div><div class="amt">$3</div><div class="lbl">Small Drip</div><div class="dsc">A quick thanks</div></div>
      <div class="tpopt" onclick="sTp(7,this)"><div class="emo">ü•ê</div><div class="amt">$7</div><div class="lbl">Coffee & Pastry</div><div class="dsc">Andy eats today</div></div>
      <div class="tpopt" onclick="sTp(15,this)"><div class="emo">‚ö°</div><div class="amt">$15</div><div class="lbl">Energy Hero</div><div class="dsc">Keep the lights on</div></div>
    </div>
    <div class="tpdiv">or custom amount</div>
    <div style="display:flex;gap:10px"><div class="tpcw"><span style="position:absolute;left:14px;top:50%;transform:translateY(-50%);color:#666;font-size:16px">$</span><input type="number" id="cTpI" class="tpci" placeholder="5.00" oninput="sCTp()" onfocus="sCTp()"></div></div>
    <button class="btn-tps" id="tpSB" onclick="doTp()">Select an Amount</button>
    <div class="tpf">100% goes to keeping WattWise free. No middlemen.</div>
  </div>
  <div class="mdl tpty" id="tpTy" style="display:none"><div class="emo">üíö</div><h3>You're Amazing!</h3><p>Your <span id="tpTA">$0</span> tip helps Andy keep WattWise free. You're saving <strong id="tpTS">$0/yr</strong> and paying it forward.</p><button class="btn-cta" onclick="xTp()">Close</button></div>
</div>

<!-- REGISTRATION MODAL -->

<div class="ov" id="rgOv" onclick="xOv(event,'rgOv')"><div class="mdl rmdl" id="rgMdl">
  <!-- Step 1: Savings -->
  <div class="rstep act" id="rs1">
    <div style="display:flex;justify-content:flex-end;padding:12px 20px 0;flex-shrink:0"><button class="mdl-x" onclick="xRg()">√ó</button></div>
    <div style="flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;min-height:0">
      <div class="rsh"><div class="lb" style="color:var(--g);margin-bottom:6px">YOUR PERSONALIZED SAVINGS</div><h3 style="font-size:22px">Here's What You'll Save</h3><div class="rpb" id="rpBdg"></div></div>
      <div class="rsb">
        <div class="rcmp" id="rCmp"></div>
        <div class="rbkd" id="rBkd"></div>
      </div>
    </div>
    <div style="flex-shrink:0;background:#0f0f1a;padding:10px 20px 16px;border-top:1px solid rgba(255,255,255,.06)">
      <button class="btn-rn" onclick="subReg()">I Want This Plan ‚Üí</button>
      <button class="btn-rb" onclick="xRg()">‚Üê Back to Plans</button>
    </div>
  </div>
  <!-- Step 2: Ready to Switch -->
  <div class="rstep" id="rs2">
    <div style="display:flex;justify-content:flex-end;padding:12px 16px 0;flex-shrink:0"><button class="mdl-x" onclick="xRg()">√ó</button></div>
    <div class="rcnf" style="flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;min-height:0">
      <div class="rchk-i"><svg viewBox="0 0 24 24" fill="none" stroke="var(--g)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></div>
      <h3>Ready to Switch!</h3>
      <div class="pd">You chose <strong id="rgCPl"></strong></div>
      <div class="pd" id="rgCPv"></div>
      <div class="rcsav"><div class="big" id="rgCSv"></div><div class="lbl">estimated annual savings</div></div>
      <div class="rcns"><h4>How to Get This Plan</h4>
        <div class="nsi" id="rgPlanTip" style="background:rgba(0,220,130,.06);border-radius:8px;padding:10px 12px"><div class="nsn" style="background:var(--g);color:#0a0a0a">‚òÖ</div><div class="nst"><strong style="color:var(--g)" id="rgPlanFind"></strong> by <strong id="rgProvFind"></strong> at <strong style="color:var(--g)"><span id="rgRateFind"></span>&#162;/kWh</strong></div></div>
        <div class="nsi"><div class="nsn">1</div><div class="nst"><strong>Click "Sign Up"</strong> below to go to the provider's enrollment page</div></div>
        <div class="nsi"><div class="nsn">2</div><div class="nst"><strong>Enter ZIP code <span id="rgZipShow"></span></strong> on their site and select the plan above</div></div>
        <div class="nsi"><div class="nsn">3</div><div class="nst"><strong>Have your ESID ready</strong> ‚Äî it's on your current electric bill</div></div>
        <div class="nsi"><div class="nsn">4</div><div class="nst"><strong>No interruption</strong> ‚Äî same wires, same meter, new rate in 1-2 billing cycles</div></div>
      </div>
      <div class="tipnudge">
        <div class="tipnudge-line"></div>
        <div class="tipnudge-inner">
          <span class="tipnudge-txt">Andy found you this rate for free.</span>
          <button class="tipnudge-btn" onclick="xRg();openTip()">‚òï Buy him a coffee?</button>
        </div>
      </div>
    </div>
    <div style="flex-shrink:0;background:#0f0f1a;padding:10px 20px 16px;border-top:1px solid rgba(255,255,255,.06)">
      <button class="btn-rn" id="rgGoBtn" onclick="goProvider()" style="font-size:16px">Sign Up for This Plan ‚Üí</button>
      <button class="btn-rb" onclick="rgStep(1)">‚Üê Back to Savings</button>
    </div>
  </div>
</div></div>

<!-- ADMIN PANEL (access: 4√ó click logo or #admin in URL ‚Äî PIN protected) -->

<div class="ov" id="adOv" onclick="xOv(event,'adOv')"><div class="mdl admdl" id="adMdl" style="max-width:600px">
  <div style="display:flex;justify-content:space-between;align-items:flex-start;padding:24px 24px 0;flex-shrink:0">
    <div><div class="lb" style="color:var(--o);margin-bottom:6px">ADMIN PANEL</div><h3 style="font-family:var(--fd);font-size:22px;color:#fff;margin:0">WattWise Settings</h3></div>
    <button class="mdl-x" onclick="xAd()">√ó</button>
  </div>
  <div style="padding:20px 24px 28px;flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;min-height:0">
    <!-- Affiliate Programs -->
    <div class="ad-sec">
      <div class="ad-title">ü§ù Affiliate Programs</div>
      <div class="ad-desc">Track affiliate partnership applications and integration status. Commissions: $15-100 per enrollment.</div>
      <table style="width:100%;font-size:11px;font-family:var(--fm);border-collapse:collapse">
        <tr style="color:rgba(0,220,130,.6);text-align:left;border-bottom:1px solid rgba(0,220,130,.1)">
          <th style="padding:6px 4px">Partner</th><th style="padding:6px 4px">Status</th><th style="padding:6px 4px">Commission</th><th style="padding:6px 4px">Notes</th>
        </tr>
        <tr style="color:#ccc;border-bottom:1px solid rgba(0,220,130,.06)">
          <td style="padding:8px 4px"><a href="https://friends.comparepower.com/affiliates/" target="_blank" style="color:var(--g)">Compare Power</a></td>
          <td style="padding:8px 4px"><span style="background:rgba(250,204,21,.15);color:var(--y);padding:2px 8px;border-radius:4px;font-size:10px">Applied</span></td>
          <td style="padding:8px 4px">Per enrollment</td>
          <td style="padding:8px 4px;font-size:10px;color:#666">"Friends of Compare Power" program</td>
        </tr>
        <tr style="color:#ccc;border-bottom:1px solid rgba(0,220,130,.06)">
          <td style="padding:8px 4px"><a href="https://www.choosetexaspower.org/affiliates/" target="_blank" style="color:var(--g)">Choose Texas Power</a></td>
          <td style="padding:8px 4px"><span style="background:rgba(255,255,255,.08);color:#888;padding:2px 8px;border-radius:4px;font-size:10px">To Apply</span></td>
          <td style="padding:8px 4px">Per enrollment + tiers</td>
          <td style="padding:8px 4px;font-size:10px;color:#666">Email: partnerships@saveonenergy.com</td>
        </tr>
        <tr style="color:#ccc;border-bottom:1px solid rgba(0,220,130,.06)">
          <td style="padding:8px 4px"><a href="https://www.electricchoice.com/electricity-affiliate-program/" target="_blank" style="color:var(--g)">Electric Choice</a></td>
          <td style="padding:8px 4px"><span style="background:rgba(255,255,255,.08);color:#888;padding:2px 8px;border-radius:4px;font-size:10px">To Apply</span></td>
          <td style="padding:8px 4px">Per enrollment</td>
          <td style="padding:8px 4px;font-size:10px;color:#666">Custom banners, A/B testing support</td>
        </tr>
        <tr style="color:#aaa">
          <td style="padding:8px 4px"><a href="https://www.directenergy.com/partner" target="_blank" style="color:var(--g)">Direct Energy</a></td>
          <td style="padding:8px 4px"><span style="background:rgba(255,255,255,.08);color:#888;padding:2px 8px;border-radius:4px;font-size:10px">To Apply</span></td>
          <td style="padding:8px 4px">Per enrollment</td>
          <td style="padding:8px 4px;font-size:10px;color:#666">Channel Partner ‚Äî single REP, zero investment</td>
        </tr>
      </table>
      <div style="font-size:10px;color:#555;margin-top:8px;font-family:var(--fm)">No broker license needed for affiliate links ‚Äî acting as marketing publisher only.</div>
    </div>
    <!-- Broker Data Sources -->
    <div class="ad-sec">
      <div class="ad-title">üîë Broker Data Sources (Andy's License)</div>
      <div class="ad-desc">With a PUCT broker license, Andy can access additional rate data beyond PowerToChoose.org public CSV.</div>
      <table style="width:100%;font-size:11px;font-family:var(--fm);border-collapse:collapse">
        <tr style="color:rgba(0,220,130,.6);text-align:left;border-bottom:1px solid rgba(0,220,130,.1)">
          <th style="padding:6px 4px">Source</th><th style="padding:6px 4px">Access</th><th style="padding:6px 4px">Data Type</th>
        </tr>
        <tr style="color:#ccc;border-bottom:1px solid rgba(0,220,130,.06)">
          <td style="padding:8px 4px">PowerToChoose.org CSV</td>
          <td style="padding:8px 4px"><span style="background:rgba(0,220,130,.15);color:var(--g);padding:2px 8px;border-radius:4px;font-size:10px">Active</span></td>
          <td style="padding:8px 4px">1,200+ residential plans, all TDUs</td>
        </tr>
        <tr style="color:#ccc;border-bottom:1px solid rgba(0,220,130,.06)">
          <td style="padding:8px 4px"><a href="https://www.ercot.com/mktinfo" target="_blank" style="color:var(--b)">ERCOT Market Data</a></td>
          <td style="padding:8px 4px"><span style="background:rgba(59,130,246,.15);color:var(--b);padding:2px 8px;border-radius:4px;font-size:10px">Available</span></td>
          <td style="padding:8px 4px">Real-time wholesale LMPs, load forecasts</td>
        </tr>
        <tr style="color:#ccc;border-bottom:1px solid rgba(0,220,130,.06)">
          <td style="padding:8px 4px">REP Direct Pricing Portals</td>
          <td style="padding:8px 4px"><span style="background:rgba(250,204,21,.15);color:var(--y);padding:2px 8px;border-radius:4px;font-size:10px">Broker Access</span></td>
          <td style="padding:8px 4px">Custom residential quotes, unpublished rates</td>
        </tr>
        <tr style="color:#ccc;border-bottom:1px solid rgba(0,220,130,.06)">
          <td style="padding:8px 4px">REP Broker Commission Portals</td>
          <td style="padding:8px 4px"><span style="background:rgba(250,204,21,.15);color:var(--y);padding:2px 8px;border-radius:4px;font-size:10px">Broker Access</span></td>
          <td style="padding:8px 4px">Direct commissions per enrollment, tracking</td>
        </tr>
        <tr style="color:#ccc;border-bottom:1px solid rgba(0,220,130,.06)">
          <td style="padding:8px 4px"><a href="https://www.eia.gov/electricity/wholesalemarkets/ercot.php" target="_blank" style="color:var(--b)">EIA / ERCOT Reports</a></td>
          <td style="padding:8px 4px"><span style="background:rgba(59,130,246,.15);color:var(--b);padding:2px 8px;border-radius:4px;font-size:10px">Available</span></td>
          <td style="padding:8px 4px">Historical wholesale rates, demand trends</td>
        </tr>
        <tr style="color:#aaa">
          <td style="padding:8px 4px">Commercial Rate Quotes</td>
          <td style="padding:8px 4px"><span style="background:rgba(250,204,21,.15);color:var(--y);padding:2px 8px;border-radius:4px;font-size:10px">Broker Access</span></td>
          <td style="padding:8px 4px">Business rates not on PowerToChoose (no public site exists)</td>
        </tr>
      </table>
      <!-- Broker Connection Settings -->
      <div style="border-top:1px solid rgba(0,220,130,.12);padding-top:14px;margin-top:14px">
        <div style="font-size:12px;color:var(--g);margin-bottom:10px;font-weight:700">üîå Broker Portal Credentials</div>
        <div id="adBrkSaveStatus" style="font-size:11px;font-family:var(--fm);margin-bottom:8px;min-height:16px"></div>
        <div style="font-size:10px;color:var(--g);margin-bottom:10px;padding:10px 12px;background:rgba(0,220,130,.06);border:1px solid rgba(0,220,130,.15);border-radius:8px;line-height:1.5">üí° Andy contacts each REP's channel partner team with his PUCT broker license # to request portal access. Credentials go here once received.</div>
        <div style="font-size:10px;letter-spacing:1.2px;text-transform:uppercase;color:rgba(0,220,130,.55);font-family:var(--fm);margin:12px 0 6px;font-weight:700">PUCT Broker Registration</div>
        <div class="ad-field"><label>PUCT License Number</label><input class="rinp" id="adBrkLicense" placeholder="BR######" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Broker Business Name</label><input class="rinp" id="adBrkName" placeholder="e.g. WattWise Energy LLC" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Broker Contact Email</label><input class="rinp" id="adBrkEmail" placeholder="andy@wattwiseenergy.com" oninput="saveBroker()"></div>
        <div style="font-size:10px;letter-spacing:1.2px;text-transform:uppercase;color:rgba(0,220,130,.55);font-family:var(--fm);margin:16px 0 6px;font-weight:700">REP Broker Portals</div>
        <div class="ad-field"><label>TXU Energy ‚Äî <a href="https://www.txu.com/business-electricity/channel-partners" target="_blank" style="color:var(--g)">Apply Here</a></label><input class="rinp" id="adRepTXU" placeholder="Portal URL / username" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Reliant Energy ‚Äî <a href="https://www.reliant.com" target="_blank" style="color:var(--g)">Contact Channel Team</a></label><input class="rinp" id="adRepReliant" placeholder="Portal URL / username" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Direct Energy ‚Äî <a href="https://www.directenergy.com/partner" target="_blank" style="color:var(--g)">Apply Here</a></label><input class="rinp" id="adRepDirect" placeholder="Portal URL / username" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Gexa Energy ‚Äî <a href="https://www.gexaenergy.com" target="_blank" style="color:var(--g)">Contact Channel Team</a></label><input class="rinp" id="adRepGexa" placeholder="Portal URL / username" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Constellation ‚Äî Contact Channel Team</label><input class="rinp" id="adRepConstellation" placeholder="Portal URL / username" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Frontier Utilities ‚Äî Contact Channel Team</label><input class="rinp" id="adRepFrontier" placeholder="Portal URL / username" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Rhythm Energy ‚Äî Contact Channel Team</label><input class="rinp" id="adRepRhythm" placeholder="Portal URL / username" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Chariot Energy ‚Äî Contact Channel Team</label><input class="rinp" id="adRepChariot" placeholder="Portal URL / username" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Payless Power ‚Äî Contact Channel Team</label><input class="rinp" id="adRepPayless" placeholder="Portal URL / username" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Cirro Energy ‚Äî Contact Channel Team</label><input class="rinp" id="adRepCirro" placeholder="Portal URL / username" oninput="saveBroker()"></div>
        <div style="font-size:10px;letter-spacing:1.2px;text-transform:uppercase;color:rgba(0,220,130,.55);font-family:var(--fm);margin:16px 0 6px;font-weight:700">Data Feeds &amp; APIs</div>
        <div class="ad-field"><label>ERCOT Public API ‚Äî <a href="https://www.ercot.com/services/mdt/data-portal" target="_blank" style="color:var(--b)">Data Portal</a></label><input class="rinp" id="adErcotKey" placeholder="API key (free registration)" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Smart Meter Texas ‚Äî <a href="https://www.smartmetertexas.com" target="_blank" style="color:var(--b)">SMT Portal</a></label><input class="rinp" id="adSMT" placeholder="Username (broker can pull customer usage with consent)" oninput="saveBroker()"></div>
        <div class="ad-field"><label>PowerToChoose.org CSV ‚Äî <span style="color:var(--g)">Active via GitHub Actions scraper</span></label><input class="rinp" value="http://www.powertochoose.org/en-us/Plan/ExportToCsv" disabled style="color:#555"></div>
        <div class="ad-field"><label>EIA Open Data API ‚Äî <a href="https://www.eia.gov/opendata/" target="_blank" style="color:var(--b)">Register for Key</a></label><input class="rinp" id="adEIA" placeholder="API key (free)" oninput="saveBroker()"></div>
        <div style="font-size:10px;letter-spacing:1.2px;text-transform:uppercase;color:rgba(0,220,130,.55);font-family:var(--fm);margin:16px 0 6px;font-weight:700">Supabase (Live Database)</div>
        <div class="ad-field"><label>Supabase Project URL</label><input class="rinp" id="adSupaURL" placeholder="https://xxxxx.supabase.co" oninput="saveBroker()"></div>
        <div class="ad-field"><label>Supabase Anon Key (public reads)</label><input class="rinp" id="adSupaAnon" placeholder="eyJ..." oninput="saveBroker()"></div>
        <div class="ad-field"><label>Supabase Service Key (scraper writes ‚Äî keep secret)</label><input class="rinp" id="adSupaService" type="password" placeholder="eyJ... (stored in GitHub Secrets)" oninput="saveBroker()"></div>
      </div>
    </div>
    <!-- Stripe Config -->
    <div class="ad-sec">
      <div class="ad-title">üí≥ Stripe Tip Links</div>
      <div class="ad-desc">Create Payment Links at <a href="https://dashboard.stripe.com/payment-links" target="_blank" style="color:var(--g)">dashboard.stripe.com/payment-links</a></div>
      <div class="ad-field"><label>$3 Tip Link</label><input class="rinp" id="adS3" placeholder="https://buy.stripe.com/..." oninput="saveAdmin()"></div>
      <div class="ad-field"><label>$7 Tip Link</label><input class="rinp" id="adS7" placeholder="https://buy.stripe.com/..." oninput="saveAdmin()"></div>
      <div class="ad-field"><label>$15 Tip Link</label><input class="rinp" id="adS15" placeholder="https://buy.stripe.com/..." oninput="saveAdmin()"></div>
      <div class="ad-field"><label>Custom Amount Link</label><input class="rinp" id="adSC" placeholder="https://buy.stripe.com/..." oninput="saveAdmin()"></div>
      <div class="ad-status" id="adStripeStatus">‚ö†Ô∏è Demo mode ‚Äî tips simulate only</div>
    </div>
    <!-- Stats -->
    <div class="ad-sec">
      <div class="ad-title">üìä Session Stats</div>
      <div class="ad-stats">
        <div class="ad-stat"><span class="ad-stat-n" id="adSearches">0</span><span class="ad-stat-l">Searches</span></div>
        <div class="ad-stat"><span class="ad-stat-n" id="adPlanClicks">0</span><span class="ad-stat-l">Plan Views</span></div>
        <div class="ad-stat"><span class="ad-stat-n" id="adProvClicks">0</span><span class="ad-stat-l">Provider Clicks</span></div>
        <div class="ad-stat"><span class="ad-stat-n" id="adTipClicks">0</span><span class="ad-stat-l">Tip Clicks</span></div>
      </div>
      <div style="font-size:10px;color:#555;margin-top:8px;font-family:var(--fm)">Session-only. For persistent analytics, add Google Analytics or Plausible.</div>
    </div>
    <!-- Commission Dashboard -->
    <div class="ad-sec">
      <div class="ad-title">üí∞ Commission Dashboard</div>
      <div class="ad-desc">Revenue split between Andy and Robert. Enter commissions manually as they come in from affiliate partners.</div>
      <div id="adCommStats" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px">
        <div class="ad-stat"><span class="ad-stat-n" id="adTotalRev">$0</span><span class="ad-stat-l">Total Revenue</span></div>
        <div class="ad-stat"><span class="ad-stat-n" id="adAndyRev" style="color:var(--g)">$0</span><span class="ad-stat-l">Andy's Share</span></div>
        <div class="ad-stat"><span class="ad-stat-n" id="adRobertRev" style="color:var(--b)">$0</span><span class="ad-stat-l">Robert's Share</span></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
        <div class="ad-stat"><span class="ad-stat-n" id="adTotalClicks">0</span><span class="ad-stat-l">Total Clicks</span></div>
        <div class="ad-stat"><span class="ad-stat-n" id="adPendingComm">$0</span><span class="ad-stat-l">Pending</span></div>
      </div>
      <div style="margin-bottom:10px">
        <label style="display:block;font-size:9px;letter-spacing:1.5px;text-transform:uppercase;color:#555;font-family:var(--fm);margin-bottom:4px">Revenue Split (Andy %)</label>
        <div style="display:flex;gap:8px;align-items:center">
          <input class="rinp" id="adSplitPct" type="number" min="0" max="100" value="50" style="width:80px" oninput="saveSplit()">
          <span style="font-size:11px;color:#888;font-family:var(--fm)">Andy: <span id="adSplitA">50</span>% / Robert: <span id="adSplitR">50</span>%</span>
        </div>
      </div>
      <div style="border-top:1px solid rgba(255,255,255,.06);padding-top:12px;margin-top:8px">
        <div style="font-size:11px;color:#aaa;margin-bottom:8px;font-weight:600">Add Commission</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:6px">
          <div class="ad-field" style="margin:0"><label>Partner</label><select class="rinp" id="adCommPartner" style="padding:8px"><option>Compare Power</option><option>Choose Texas Power</option><option>Electric Choice</option><option>Direct Energy</option><option>REP Direct</option><option>Tips</option><option>Other</option></select></div>
          <div class="ad-field" style="margin:0"><label>Amount ($)</label><input class="rinp" id="adCommAmt" type="number" step="0.01" placeholder="50.00"></div>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-bottom:8px">
          <div class="ad-field" style="margin:0"><label>Customer ZIP</label><input class="rinp" id="adCommZip" placeholder="75087"></div>
          <div class="ad-field" style="margin:0"><label>Status</label><select class="rinp" id="adCommStatus" style="padding:8px"><option>pending</option><option>confirmed</option><option>paid</option></select></div>
        </div>
        <div class="ad-field" style="margin-bottom:8px"><label>Notes</label><input class="rinp" id="adCommNotes" placeholder="e.g. Discount Power Saver 12 enrollment"></div>
        <button class="btn-rn" onclick="addCommission()" style="font-size:13px;padding:10px">+ Add Commission Entry</button>
      </div>
      <div id="adCommLog" style="margin-top:12px;max-height:200px;overflow-y:auto"></div>
    </div>
    <button class="btn-rn" onclick="xAd()" style="margin-top:10px">Close Admin Panel</button>
    <div style="display:flex;justify-content:center;gap:16px;margin-top:10px">
      <button style="background:none;color:#555;font-size:11px;font-family:var(--fm)" onclick="resetPin()">üîí Reset PIN</button>
      <span style="color:#333;font-size:11px">Admin: 4√ó click logo or #admin in URL</span>
    </div>
  </div>
</div></div>

<div id="confC"></div>

<script>
// ============================================================
// SUPABASE CONFIG
// Replace with your Supabase project URL and anon (public) key
// Get these from: Supabase Dashboard ‚Üí Settings ‚Üí API
// ============================================================
const SUPABASE_URL = 'https://gmxckbdnaegnbynyrkts.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdteGNrYmRuYWVnbmJ5bnlya3RzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3Mjk3ODUsImV4cCI6MjA4NzMwNTc4NX0.IMXRFk6ShxGsR6xk-zoac9M9-qmas7p9-K2Lp_-dsU4';

// Hardcoded fallback data (used when Supabase is not configured)
const DB_FALLBACK={tdu:{ONCOR:{n:"Oncor Electric Delivery",r:"Dallas/Fort Worth, Waco, Midland"},CENTPT:{n:"CenterPoint Energy",r:"Houston Metro"},TNMP:{n:"Texas-New Mexico Power",r:"Various TX cities"},AEP_TCC:{n:"AEP Texas Central",r:"Corpus Christi, Victoria"},AEP_TNC:{n:"AEP Texas North",r:"Abilene, San Angelo, El Paso"}},
z2t:{"75001":"ONCOR","75002":"ONCOR","75006":"ONCOR","75007":"ONCOR","75019":"ONCOR","75024":"ONCOR","75025":"ONCOR","75032":"ONCOR","75034":"ONCOR","75035":"ONCOR","75040":"ONCOR","75041":"ONCOR","75042":"ONCOR","75043":"ONCOR","75044":"ONCOR","75048":"ONCOR","75050":"ONCOR","75051":"ONCOR","75052":"ONCOR","75060":"ONCOR","75061":"ONCOR","75062":"ONCOR","75063":"ONCOR","75070":"ONCOR","75071":"ONCOR","75074":"ONCOR","75075":"ONCOR","75080":"ONCOR","75081":"ONCOR","75082":"ONCOR","75087":"ONCOR","75089":"ONCOR","75093":"ONCOR","75094":"ONCOR","75098":"ONCOR","75104":"ONCOR","75115":"ONCOR","75116":"ONCOR","75134":"ONCOR","75137":"ONCOR","75141":"ONCOR","75146":"ONCOR","75149":"ONCOR","75150":"ONCOR","75154":"ONCOR","75159":"ONCOR","75166":"ONCOR","75172":"ONCOR","75180":"ONCOR","75181":"ONCOR","75182":"ONCOR","75189":"ONCOR","75201":"ONCOR","75202":"ONCOR","75203":"ONCOR","75204":"ONCOR","75205":"ONCOR","75206":"ONCOR","75207":"ONCOR","75208":"ONCOR","75209":"ONCOR","75210":"ONCOR","75211":"ONCOR","75212":"ONCOR","75214":"ONCOR","75215":"ONCOR","75216":"ONCOR","75217":"ONCOR","75218":"ONCOR","75219":"ONCOR","75220":"ONCOR","75223":"ONCOR","75224":"ONCOR","75225":"ONCOR","75226":"ONCOR","75227":"ONCOR","75228":"ONCOR","75229":"ONCOR","75230":"ONCOR","75231":"ONCOR","75232":"ONCOR","75233":"ONCOR","75234":"ONCOR","75235":"ONCOR","75236":"ONCOR","75237":"ONCOR","75238":"ONCOR","75240":"ONCOR","75241":"ONCOR","75243":"ONCOR","75244":"ONCOR","75246":"ONCOR","75247":"ONCOR","75248":"ONCOR","75249":"ONCOR","75251":"ONCOR","75252":"ONCOR","75253":"ONCOR","75254":"ONCOR","76001":"ONCOR","76002":"ONCOR","76006":"ONCOR","76010":"ONCOR","76011":"ONCOR","76012":"ONCOR","76013":"ONCOR","76014":"ONCOR","76015":"ONCOR","76016":"ONCOR","76017":"ONCOR","76018":"ONCOR","76034":"ONCOR","76039":"ONCOR","76040":"ONCOR","76051":"ONCOR","76052":"ONCOR","76053":"ONCOR","76054":"ONCOR","76060":"ONCOR","76063":"ONCOR","76092":"ONCOR","76101":"ONCOR","76102":"ONCOR","76103":"ONCOR","76104":"ONCOR","76105":"ONCOR","76106":"ONCOR","76107":"ONCOR","76108":"ONCOR","76109":"ONCOR","76110":"ONCOR","76111":"ONCOR","76112":"ONCOR","76116":"ONCOR","76117":"ONCOR","76118":"ONCOR","76119":"ONCOR","76120":"ONCOR","76123":"ONCOR","76126":"ONCOR","76127":"ONCOR","76131":"ONCOR","76132":"ONCOR","76133":"ONCOR","76134":"ONCOR","76135":"ONCOR","76137":"ONCOR","76140":"ONCOR","76148":"ONCOR","76155":"ONCOR","76164":"ONCOR","76177":"ONCOR","76179":"ONCOR","76180":"ONCOR","76182":"ONCOR","76244":"ONCOR","76248":"ONCOR","76262":"ONCOR","76701":"ONCOR","76702":"ONCOR","76704":"ONCOR","76705":"ONCOR","76706":"ONCOR","76707":"ONCOR","76708":"ONCOR","76710":"ONCOR","76711":"ONCOR","76712":"ONCOR","76798":"ONCOR","77001":"CENTPT","77002":"CENTPT","77003":"CENTPT","77004":"CENTPT","77005":"CENTPT","77006":"CENTPT","77007":"CENTPT","77008":"CENTPT","77009":"CENTPT","77010":"CENTPT","77011":"CENTPT","77012":"CENTPT","77013":"CENTPT","77014":"CENTPT","77015":"CENTPT","77016":"CENTPT","77017":"CENTPT","77018":"CENTPT","77019":"CENTPT","77020":"CENTPT","77021":"CENTPT","77022":"CENTPT","77023":"CENTPT","77024":"CENTPT","77025":"CENTPT","77026":"CENTPT","77027":"CENTPT","77028":"CENTPT","77029":"CENTPT","77030":"CENTPT","77031":"CENTPT","77032":"CENTPT","77033":"CENTPT","77034":"CENTPT","77035":"CENTPT","77036":"CENTPT","77037":"CENTPT","77038":"CENTPT","77039":"CENTPT","77040":"CENTPT","77041":"CENTPT","77042":"CENTPT","77043":"CENTPT","77044":"CENTPT","77045":"CENTPT","77046":"CENTPT","77047":"CENTPT","77048":"CENTPT","77049":"CENTPT","77050":"CENTPT","77051":"CENTPT","77053":"CENTPT","77054":"CENTPT","77055":"CENTPT","77056":"CENTPT","77057":"CENTPT","77058":"CENTPT","77059":"CENTPT","77060":"CENTPT","77061":"CENTPT","77062":"CENTPT","77063":"CENTPT","77064":"CENTPT","77065":"CENTPT","77066":"CENTPT","77067":"CENTPT","77068":"CENTPT","77069":"CENTPT","77070":"CENTPT","77071":"CENTPT","77072":"CENTPT","77073":"CENTPT","77074":"CENTPT","77075":"CENTPT","77076":"CENTPT","77077":"CENTPT","77078":"CENTPT","77079":"CENTPT","77080":"CENTPT","77081":"CENTPT","77082":"CENTPT","77083":"CENTPT","77084":"CENTPT","77085":"CENTPT","77086":"CENTPT","77087":"CENTPT","77088":"CENTPT","77089":"CENTPT","77090":"CENTPT","77091":"CENTPT","77092":"CENTPT","77093":"CENTPT","77094":"CENTPT","77095":"CENTPT","77096":"CENTPT","77098":"CENTPT","77099":"CENTPT","77301":"CENTPT","77302":"CENTPT","77303":"CENTPT","77304":"CENTPT","77316":"CENTPT","77339":"CENTPT","77345":"CENTPT","77346":"CENTPT","77354":"CENTPT","77355":"CENTPT","77356":"CENTPT","77362":"CENTPT","77365":"CENTPT","77373":"CENTPT","77375":"CENTPT","77377":"CENTPT","77378":"CENTPT","77379":"CENTPT","77380":"CENTPT","77381":"CENTPT","77382":"CENTPT","77384":"CENTPT","77385":"CENTPT","77386":"CENTPT","77388":"CENTPT","77389":"CENTPT","77401":"CENTPT","77406":"CENTPT","77407":"CENTPT","77429":"CENTPT","77433":"CENTPT","77449":"CENTPT","77450":"CENTPT","77459":"CENTPT","77469":"CENTPT","77471":"CENTPT","77477":"CENTPT","77478":"CENTPT","77479":"CENTPT","77489":"CENTPT","77494":"CENTPT","77498":"CENTPT","77504":"CENTPT","77505":"CENTPT","77506":"CENTPT","77507":"CENTPT","77520":"CENTPT","77521":"CENTPT","77530":"CENTPT","77532":"CENTPT","77536":"CENTPT","77539":"CENTPT","77546":"CENTPT","77550":"CENTPT","77551":"CENTPT","77563":"CENTPT","77565":"CENTPT","77571":"CENTPT","77573":"CENTPT","77581":"CENTPT","77583":"CENTPT","77584":"CENTPT","77586":"CENTPT","77587":"CENTPT","77590":"CENTPT","77591":"CENTPT","75459":"TNMP","75490":"TNMP","76028":"TNMP","76031":"TNMP","76033":"TNMP","76044":"TNMP","76048":"TNMP","76049":"TNMP","76058":"TNMP","76059":"TNMP","76065":"TNMP","76066":"TNMP","76070":"TNMP","76084":"TNMP","76093":"TNMP","76433":"TNMP","76446":"TNMP","76457":"TNMP","76462":"TNMP","78373":"AEP_TCC","78401":"AEP_TCC","78402":"AEP_TCC","78404":"AEP_TCC","78405":"AEP_TCC","78407":"AEP_TCC","78408":"AEP_TCC","78409":"AEP_TCC","78410":"AEP_TCC","78411":"AEP_TCC","78412":"AEP_TCC","78413":"AEP_TCC","78414":"AEP_TCC","78415":"AEP_TCC","78416":"AEP_TCC","78417":"AEP_TCC","78418":"AEP_TCC","78380":"AEP_TCC","78102":"AEP_TCC","77901":"AEP_TCC","77904":"AEP_TCC","77905":"AEP_TCC","79601":"AEP_TNC","79602":"AEP_TNC","79603":"AEP_TNC","79605":"AEP_TNC","79606":"AEP_TNC","79607":"AEP_TNC","76821":"AEP_TNC","76901":"AEP_TNC","76903":"AEP_TNC","76904":"AEP_TNC","76905":"AEP_TNC","79901":"AEP_TNC","79902":"AEP_TNC","79903":"AEP_TNC","79904":"AEP_TNC","79905":"AEP_TNC","79907":"AEP_TNC","79911":"AEP_TNC","79912":"AEP_TNC","79915":"AEP_TNC","79924":"AEP_TNC","79925":"AEP_TNC","79927":"AEP_TNC","79928":"AEP_TNC","79930":"AEP_TNC","79932":"AEP_TNC","79934":"AEP_TNC","79935":"AEP_TNC","79936":"AEP_TNC","79938":"AEP_TNC"},
p:{ONCOR:[{p:"TXU Energy",n:"Simple Rate 12",r:11.9,t:12,re:6,s:4.2,cf:150},{p:"TXU Energy",n:"Free Nights",r:14.3,t:12,re:0,s:3.8,cf:150},{p:"Reliant Energy",n:"Secure Advantage 12",r:11.5,t:12,re:0,s:4.0,cf:150},{p:"Reliant Energy",n:"Truly Free Weekends 12",r:13.8,t:12,re:27,s:3.9,cf:150},{p:"Gexa Energy",n:"Gexa Saver Deluxe 12",r:10.8,t:12,re:0,s:3.5,cf:150},{p:"Gexa Energy",n:"Gexa Green 12",r:11.4,t:12,re:100,s:3.6,cf:150},{p:"Green Mountain",n:"Pollution Free e-Plus 12",r:12.1,t:12,re:100,s:4.5,cf:150},{p:"Constellation",n:"12 Month Home Power",r:10.5,t:12,re:0,s:3.7,cf:175},{p:"Constellation",n:"Green Home Power 12",r:11.2,t:12,re:100,s:3.8,cf:175},{p:"4Change Energy",n:"Maxx Saver 12",r:10.2,t:12,re:0,s:3.3,cf:150},{p:"4Change Energy",n:"Earth Day Every Day 12",r:10.9,t:12,re:100,s:3.4,cf:150},{p:"Frontier Utilities",n:"Super Value 12",r:10.6,t:12,re:0,s:3.2,cf:175},{p:"Chariot Energy",n:"Solar 12",r:11.7,t:12,re:100,s:4.1,cf:150},{p:"Pulse Power",n:"Texas Fixed 12",r:10.4,t:12,re:4,s:3.1,cf:150},{p:"Rhythm Energy",n:"Fixed 12",r:11.1,t:12,re:100,s:4.3,cf:0},{p:"Express Energy",n:"Flash 12",r:10.1,t:12,re:0,s:2.9,cf:200},{p:"Discount Power",n:"Saver 12 Plan",r:10.0,t:12,re:0,s:2.8,cf:175},{p:"Veteran Energy",n:"Salute 12",r:11.6,t:12,re:10,s:3.9,cf:150},{p:"TriEagle Energy",n:"Eagle 12",r:10.7,t:12,re:0,s:3.0,cf:199}],
CENTPT:[{p:"TXU Energy",n:"Simple Rate 12",r:12.4,t:12,re:6,s:4.2,cf:150},{p:"TXU Energy",n:"Free Nights",r:14.8,t:12,re:0,s:3.8,cf:150},{p:"Reliant Energy",n:"Secure Advantage 12",r:12.0,t:12,re:0,s:4.0,cf:150},{p:"Reliant Energy",n:"Conservation 12",r:12.6,t:12,re:30,s:4.1,cf:150},{p:"Gexa Energy",n:"Gexa Saver Deluxe 12",r:11.3,t:12,re:0,s:3.5,cf:150},{p:"Gexa Energy",n:"Gexa Green 12",r:11.9,t:12,re:100,s:3.6,cf:150},{p:"Green Mountain",n:"Pollution Free e-Plus 12",r:12.7,t:12,re:100,s:4.5,cf:150},{p:"Constellation",n:"12 Month Home Power",r:11.0,t:12,re:0,s:3.7,cf:175},{p:"4Change Energy",n:"Maxx Saver 12",r:10.7,t:12,re:0,s:3.3,cf:150},{p:"Frontier Utilities",n:"Super Value 12",r:11.1,t:12,re:0,s:3.2,cf:175},{p:"Chariot Energy",n:"Solar 12",r:12.2,t:12,re:100,s:4.1,cf:150},{p:"Pulse Power",n:"Texas Fixed 12",r:10.9,t:12,re:4,s:3.1,cf:150},{p:"Rhythm Energy",n:"Fixed 12",r:11.6,t:12,re:100,s:4.3,cf:0},{p:"Express Energy",n:"Flash 12",r:10.6,t:12,re:0,s:2.9,cf:200},{p:"Discount Power",n:"Saver 12 Plan",r:10.5,t:12,re:0,s:2.8,cf:175},{p:"Cirro Energy",n:"Sure Savings 12",r:11.4,t:12,re:8,s:3.4,cf:150}],
TNMP:[{p:"TXU Energy",n:"Simple Rate 12",r:12.8,t:12,re:6,s:4.2,cf:150},{p:"Reliant Energy",n:"Secure Advantage 12",r:12.3,t:12,re:0,s:4.0,cf:150},{p:"Gexa Energy",n:"Gexa Saver Deluxe 12",r:11.7,t:12,re:0,s:3.5,cf:150},{p:"Constellation",n:"12 Month Home Power",r:11.4,t:12,re:0,s:3.7,cf:175},{p:"4Change Energy",n:"Maxx Saver 12",r:11.1,t:12,re:0,s:3.3,cf:150},{p:"Frontier Utilities",n:"Super Value 12",r:11.5,t:12,re:0,s:3.2,cf:175},{p:"Rhythm Energy",n:"Fixed 12",r:12.0,t:12,re:100,s:4.3,cf:0},{p:"Pulse Power",n:"Texas Fixed 12",r:11.2,t:12,re:4,s:3.1,cf:150}],
AEP_TCC:[{p:"TXU Energy",n:"Simple Rate 12",r:13.1,t:12,re:6,s:4.2,cf:150},{p:"Reliant Energy",n:"Secure Advantage 12",r:12.7,t:12,re:0,s:4.0,cf:150},{p:"Gexa Energy",n:"Gexa Saver Deluxe 12",r:12.0,t:12,re:0,s:3.5,cf:150},{p:"Constellation",n:"12 Month Home Power",r:11.8,t:12,re:0,s:3.7,cf:175},{p:"4Change Energy",n:"Maxx Saver 12",r:11.4,t:12,re:0,s:3.3,cf:150},{p:"Frontier Utilities",n:"Super Value 12",r:11.9,t:12,re:0,s:3.2,cf:175}],
AEP_TNC:[{p:"TXU Energy",n:"Simple Rate 12",r:13.4,t:12,re:6,s:4.2,cf:150},{p:"Reliant Energy",n:"Secure Advantage 12",r:13.0,t:12,re:0,s:4.0,cf:150},{p:"Gexa Energy",n:"Gexa Saver Deluxe 12",r:12.3,t:12,re:0,s:3.5,cf:150},{p:"Constellation",n:"12 Month Home Power",r:12.1,t:12,re:0,s:3.7,cf:175},{p:"4Change Energy",n:"Maxx Saver 12",r:11.7,t:12,re:0,s:3.3,cf:150}]},
po:{ONCOR:17.8,CENTPT:18.2,TNMP:18.5,AEP_TCC:19.1,AEP_TNC:19.4},sa:14.6};

// Active database (starts as fallback, replaced by Supabase if available)
let DB = JSON.parse(JSON.stringify(DB_FALLBACK));
let dbSource = 'local';
let dbUpdated = 'Feb 20, 2026';

// Try to load live data from Supabase
async function loadFromSupabase() {
  if (!SUPABASE_URL || !SUPABASE_ANON_KEY) { console.log('WattWise: No Supabase config'); return false; }
  try {
    const resp = await fetch(`${SUPABASE_URL}/rest/v1/plans?select=*&order=rate_kwh.asc&limit=1000`, {
      headers: { 'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}` }
    });
    console.log('WattWise: Supabase response status:', resp.status);
    if (!resp.ok) { const err = await resp.text(); console.log('WattWise: Supabase error:', err); return false; }
    const plans = await resp.json();
    console.log('WattWise: Got', plans.length, 'plans from Supabase');
    if (!plans.length) return false;

    const grouped = {};
    plans.forEach(p => {
      if (!grouped[p.tdu]) grouped[p.tdu] = [];
      grouped[p.tdu].push({
        p: p.provider, n: p.plan_name, r: parseFloat(p.rate_kwh),
        t: p.term_months || 12, re: p.renewable_pct || 0, s: 3.5, cf: parseFloat(p.cancel_fee) || 0,
        url: p.signup_url || p.enroll_url || ''
      });
    });

    if (Object.keys(grouped).length > 0) {
      DB.p = grouped;
      dbSource = 'live';
      dbUpdated = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      const tP = Object.values(DB.p).reduce((s, p) => s + p.length, 0);
      document.getElementById('tpCnt').textContent = tP;
      document.getElementById('dbC').textContent = tP;
      document.getElementById('dbDate').textContent = dbUpdated;
      document.getElementById('dbSrc').textContent = 'üü¢ Live from PowerToChoose.org';
      console.log('WattWise: Loaded ' + tP + ' live plans across ' + Object.keys(grouped).length + ' TDUs');
      return true;
    }
  } catch (e) {
    console.log('WattWise: Supabase error:', e);
  }
  return false;
}

loadFromSupabase();

let R=null,cSort="rate",sAll=false,tpAmt=null,uCR=null,sPlan=null;
const tP=Object.values(DB.p).reduce((s,p)=>s+p.length,0),tZ=Object.keys(DB.z2t).length;
document.getElementById('tpCnt').textContent=tP;document.getElementById('tzCnt').textContent=tZ;document.getElementById('dbC').textContent=tP;
document.getElementById('zInp').addEventListener('keydown',e=>{if(e.key==='Enter')doSearch()});

function gCR(){return uCR||R.polr}
function gCL(){return uCR?'your current rate':'default TDU rate'}

function updCR(){const v=parseFloat(document.getElementById('crInp').value);uCR=(v&&v>0&&v<100)?v:null;if(R)updDisp()}
function updDisp(){const cr=gCR(),u=R.usage,ms=((cr-R.best.r)/100)*u,as=ms*12;R.ms=ms;R.as=as;
  document.getElementById('mSav').textContent='$'+Math.max(0,ms).toFixed(0);
  document.getElementById('aSav').textContent='$'+Math.max(0,as).toFixed(0);
  document.getElementById('savLbl').textContent='vs '+gCL();
  document.getElementById('ctaS').textContent='$'+Math.max(0,as).toFixed(0);
  rBars();rPlans()}

function doSearch(){const z=document.getElementById('zInp').value.trim(),u=parseInt(document.getElementById('uInp').value)||1000,e=document.getElementById('errM'),b=document.getElementById('sBtn');
  e.style.display='none';document.getElementById('resSec').classList.add('hid');sAll=false;uCR=null;
  if(!z||z.length!==5||!/^\d{5}$/.test(z)){e.textContent="Please enter a valid 5-digit Texas ZIP code";e.style.display='block';return}
  b.disabled=true;b.textContent="‚ö° Scanning...";stats.searches++;
  setTimeout(()=>{const td=DB.z2t[z];if(!td){e.textContent="ZIP not in our Texas deregulated database. Try DFW (75xxx) or Houston (77xxx).";e.style.display='block';b.disabled=false;b.textContent="Find My Best Rate";return}
    const pl=DB.p[td],po=DB.po[td],ti=DB.tdu[td],sr=[...pl].sort((a,b)=>a.r-b.r),bs=sr[0];
    R={tdu:td,territory:ti,polr:po,best:bs,sorted:sr,usage:u,zip:z,mcB:(bs.r/100)*u,mcP:(po/100)*u,mcA:(DB.sa/100)*u,ms:((po-bs.r)/100)*u,as:((po-bs.r)/100)*u*12};
    render();b.disabled=false;b.textContent="Find My Best Rate";document.getElementById('hTip').classList.add('vis');
    fire();setTimeout(()=>document.getElementById('resSec').scrollIntoView({behavior:'smooth',block:'start'}),100)},1100)}

function render(){document.getElementById('resSec').classList.remove('hid');
  document.getElementById('tduN').textContent=R.territory.n;document.getElementById('tduR').textContent=R.territory.r;
  document.getElementById('polrR').textContent=R.polr+'¬¢/kWh';document.getElementById('bRate').textContent=R.best.r+'¬¢';
  document.getElementById('bProv').textContent='per kWh ¬∑ '+R.best.p;document.getElementById('mSav').textContent='$'+R.ms.toFixed(0);
  document.getElementById('aSav').textContent='$'+R.as.toFixed(0);document.getElementById('uLbl').textContent=R.usage;
  document.getElementById('ctaS').textContent='$'+R.as.toFixed(0);document.getElementById('crInp').value='';
  rBars();rPlans();
  document.getElementById('shTxt').innerHTML=`<button class="btn-cp" onclick="cpSh()">Copy</button>Hey! I used WattWise to compare TX electricity rates and found I could save $${R.as.toFixed(0)}/year. It's free ‚Äî check it out!`}

function rBars(){const cr=gCR(),u=R.usage,cc=(cr/100)*u,ca=(DB.sa/100)*u,cb=R.mcB,mx=Math.max(cc,ca,cb);
  document.getElementById('cBars').innerHTML=[
    {l:uCR?'Your Current':'TDU Default',rt:cr,c:cc,cl:'var(--r)'},
    {l:'Texas Average',rt:DB.sa,c:ca,cl:'var(--y)'},
    {l:'Best ('+R.best.p+')',rt:R.best.r,c:cb,cl:'var(--g)'}
  ].map(b=>`<div class="brow"><div class="bhdr"><span>${b.l} (${b.rt}¬¢)</span><span class="v" style="color:${b.cl}">$${b.c.toFixed(2)}/mo</span></div><div class="btrk"><div class="bfil" style="width:${b.c/mx*100}%;background:${b.cl}"></div></div></div>`).join('')}

function rPlans(){const pl=sAll?R.sorted:R.sorted.slice(0,5);let s;
  if(cSort==='rate')s=[...pl].sort((a,b)=>a.r-b.r);else if(cSort==='rating')s=[...pl].sort((a,b)=>b.s-a.s);
  else if(cSort==='renewable')s=[...pl].sort((a,b)=>b.re-a.re);else s=[...pl].sort((a,b)=>a.p.localeCompare(b.p));
  document.getElementById('ptTitle').textContent=sAll?`All ${R.sorted.length} Plans`:'Top 5 Plans';
  document.getElementById('ptSub').textContent=`Sorted by ${cSort} ¬∑ ${R.usage} kWh/mo`;
  const cr=gCR(),cc=(cr/100)*R.usage;let h='';
  s.forEach((p,i)=>{const mc=(p.r/100)*R.usage,sv=cc-mc,asv=sv*12,ib=p.r===R.best.r,pct=cr>0?((cr-p.r)/cr*100):0,pos=sv>=0;
    const pj=JSON.stringify(p).replace(/"/g,'&quot;');
    h+=`<div class="prow${ib?' best':''} fu" style="animation-delay:${i*.06}s"><div class="prow-top"><div class="pinf"><div><span class="pprov">${p.p}</span><span class="pbdg">${ib?'<span class="bdg bdg-b">BEST RATE</span>':''}${p.re===100?'<span class="bdg bdg-g">100% GREEN</span>':''}</span></div><div class="pname">${p.n}</div><div class="pmeta">${rSt(p.s)}<span>${p.t}mo</span><span>Cancel: ${p.cf===0?'<span style="color:var(--g)">None</span>':'$'+p.cf}</span>${p.re>0&&p.re<100?'<span>'+p.re+'% green</span>':''}</div></div><div class="pprc"><div class="prate${ib?' br':''}">${p.r}¬¢</div><div class="pmo">$${mc.toFixed(2)}/mo</div>${pos?`<div class="psav">Save $${sv.toFixed(0)}/mo</div>`:`<div class="psav" style="color:var(--r)">+$${Math.abs(sv).toFixed(0)}/mo</div>`}</div></div><div class="psel"><div class="psel-info">${pos?`<span class="amt">$${asv.toFixed(0)}</span>/yr savings (${pct.toFixed(0)}% less)`:`<span style="color:var(--r)">$${Math.abs(asv).toFixed(0)}</span>/yr more`}${uCR&&pos?` <span style="color:var(--y)">vs your ${cr}¬¢</span>`:''}</div><button class="btn-sel" onclick='openReg(${pj})'>${pos?'Choose This Plan ‚Üí':'View Details ‚Üí'}</button></div></div>`});
  document.getElementById('pList').innerHTML=h;
  const ab=document.getElementById('saBtn');if(!sAll&&R.sorted.length>5){ab.style.display='block';ab.textContent=`Show all ${R.sorted.length} plans ‚Üì`}else ab.style.display='none'}

function rSt(r){const f=Math.floor(r),p=r-f;let h='<span class="stars">';for(let i=0;i<5;i++)h+=i<f?'<span class="star on">‚òÖ</span>':i===f&&p>0?'<span class="star hlf">‚òÖ</span>':'<span class="star off">‚òÖ</span>';return h+`<span class="star-n">${r}</span></span>`}
function sSort(s,b){cSort=s;document.querySelectorAll('.sbtn').forEach(x=>x.classList.remove('a'));b.classList.add('a');rPlans()}
function togAll(){sAll=true;rPlans()}

// === REGISTRATION ===
function openReg(plan){sPlan=plan;stats.planClicks++;const cr=gCR(),u=R.usage,oc=(cr/100)*u,nc=(plan.r/100)*u,ms=oc-nc,as=ms*12,pct=cr>0?((cr-plan.r)/cr*100):0,y5=as*5;
  document.getElementById('rpBdg').textContent=`${plan.p} ¬∑ ${plan.n} ¬∑ ${plan.r}¬¢/kWh`;
  document.getElementById('rCmp').innerHTML=`<div class="rcr old"><div class="rcl">${uCR?'Your Current Rate':'TDU Default Rate'}<small>${cr}¬¢/kWh</small></div><div class="rcv">$${oc.toFixed(2)}/mo</div></div><div class="rcr new"><div class="rcl">${plan.p}<small>${plan.r}¬¢/kWh ¬∑ ${plan.n}</small></div><div class="rcv">$${nc.toFixed(2)}/mo</div></div><div class="rcr sav"><div class="rcl">Your Savings<small>${pct.toFixed(1)}% reduction</small></div><div class="rcv">${ms>=0?'‚àí':'+'} $${Math.abs(ms).toFixed(2)}/mo</div></div>`;
  document.getElementById('rBkd').innerHTML=`<div class="rbk grn"><div class="l">MONTHLY</div><div class="n">$${Math.abs(ms).toFixed(0)}</div><div class="l">${ms>=0?'SAVED':'MORE'}</div></div><div class="rbk ylw"><div class="l">ANNUAL</div><div class="n">$${Math.abs(as).toFixed(0)}</div><div class="l">${as>=0?'SAVED':'MORE'}</div></div><div class="rbk blu"><div class="l">5-YEAR</div><div class="n">$${Math.abs(y5).toFixed(0)}</div><div class="l">${y5>=0?'SAVED':'MORE'}</div></div>`;
  rgStep(1);document.getElementById('rgOv').classList.add('open');document.body.style.overflow='hidden'}

function rgStep(n){document.querySelectorAll('.rstep').forEach(s=>s.classList.remove('act'));document.getElementById('rs'+n).classList.add('act');document.getElementById('rgMdl').scrollTop=0}
function xRg(){document.getElementById('rgOv').classList.remove('open');document.body.style.overflow=''}
// Provider signup URLs
const PURLS={"TXU Energy":"https://www.txu.com/enrollment","Reliant Energy":"https://www.reliant.com/en/public/residential/electricity-plans.jsp","Gexa Energy":"https://www.gexaenergy.com/electricity-plans","Green Mountain":"https://www.greenmountainenergy.com/plans","Constellation":"https://www.constellation.com/solutions/for-your-home/electricity-plans.html","4Change Energy":"https://www.4changeenergy.com/plans","Frontier Utilities":"https://www.frontierutilities.com/plans","Chariot Energy":"https://chariotenergy.com/plans","Pulse Power":"https://pulsepower.com/plans","Rhythm Energy":"https://www.gotrhythm.com/electricity-plans","Express Energy":"https://www.myexpressenergy.com","Discount Power":"https://www.discountpowertx.com","Veteran Energy":"https://www.veteranenergy.us/plans","TriEagle Energy":"https://www.trieagleenergy.com/plans","Cirro Energy":"https://www.cirroenergy.com/plans"};

function subReg(){if(!sPlan)return;const pl=sPlan,cr=gCR(),as=((cr-pl.r)/100)*R.usage*12;
  document.getElementById('rgCPl').textContent=pl.n;document.getElementById('rgCPv').innerHTML='by <strong>'+pl.p+'</strong> at <strong style="color:var(--g)">'+pl.r+'&#162;/kWh</strong>';
  document.getElementById('rgCSv').textContent='$'+Math.max(0,as).toFixed(0)+'/yr';
  document.getElementById('rgPlanFind').textContent=pl.n;
  document.getElementById('rgProvFind').textContent=pl.p;
  document.getElementById('rgRateFind').textContent=pl.r;
  document.getElementById('rgZipShow').textContent=R.zip;
  rgStep(2);stats.planClicks++;fire()}

function goProvider(){if(!sPlan||!R)return;stats.provClicks++;
  const url=sPlan.url||PURLS[sPlan.p]||'https://www.powertochoose.org';
  // Track click in Supabase
  if(SB_URL&&SB_KEY){
    const sid=sessionStorage.getItem('ww_sid')||Math.random().toString(36).substr(2,9);
    sessionStorage.setItem('ww_sid',sid);
    fetch(SB_URL+'/rest/v1/click_tracking',{method:'POST',headers:{'Content-Type':'application/json','apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Prefer':'return=minimal'},
      body:JSON.stringify({zip:R.zip,tdu:R.tdu,provider:sPlan.p,plan_name:sPlan.n,rate_kwh:sPlan.r,destination:url,affiliate_partner:'direct',session_id:sid,user_agent:navigator.userAgent.substr(0,200)})
    }).catch(()=>{});
  }
  window.open(url,'_blank')}
function goDirect(){if(!sPlan)return;const url=sPlan.url||PURLS[sPlan.p]||'https://www.powertochoose.org';window.open(url,'_blank')}

// === MODALS ===
function openStory(){document.getElementById('stOv').classList.add('open');document.body.style.overflow='hidden'}
function xSt(){document.getElementById('stOv').classList.remove('open');document.body.style.overflow=''}
function openTip(){const o=document.getElementById('tpOv');o.classList.add('open');document.body.style.overflow='hidden';
  document.getElementById('tpSel').style.display='';document.getElementById('tpTy').style.display='none';tpAmt=null;
  document.querySelectorAll('.tpopt').forEach(o=>o.classList.remove('sel'));document.getElementById('cTpI').value='';uTpB();
  if(R){document.getElementById('tpSN').style.display='block';document.getElementById('tpSA').textContent='$'+R.as.toFixed(0)+'/yr'}else document.getElementById('tpSN').style.display='none'}
function xTp(){document.getElementById('tpOv').classList.remove('open');document.body.style.overflow=''}
function xOv(e,id){if(e.target.id===id){document.getElementById(id).classList.remove('open');document.body.style.overflow=''}}
function sTp(a,el){tpAmt=a;document.querySelectorAll('.tpopt').forEach(o=>o.classList.remove('sel'));el.classList.add('sel');document.getElementById('cTpI').value='';uTpB()}
function sCTp(){const v=parseFloat(document.getElementById('cTpI').value);document.querySelectorAll('.tpopt').forEach(o=>o.classList.remove('sel'));tpAmt=v>0?v:null;uTpB()}
function uTpB(){const b=document.getElementById('tpSB');if(tpAmt>0){b.classList.add('act');b.textContent=`Send $${tpAmt.toFixed(2)} Tip ‚òï`}else{b.classList.remove('act');b.textContent='Select an Amount'}}

// ============================================================
// STRIPE PAYMENT LINKS
// Replace these placeholder URLs with your real Stripe Payment Links
// Create them at: https://dashboard.stripe.com/payment-links
// ============================================================
const STRIPE_LINKS = {
  // Preset amounts ‚Äî create fixed-price Payment Links in Stripe Dashboard
  3: 'STRIPE_LINK_3',   // Replace with: https://buy.stripe.com/your_$3_link
  7: 'STRIPE_LINK_7',   // Replace with: https://buy.stripe.com/your_$7_link
  15: 'STRIPE_LINK_15', // Replace with: https://buy.stripe.com/your_$15_link
  // Custom amounts ‚Äî create a customer-chooses-what-to-pay Payment Link
  custom: 'STRIPE_LINK_CUSTOM' // Replace with: https://buy.stripe.com/your_custom_link
};

function doTp(){
  if(!tpAmt||tpAmt<=0)return;stats.tipClicks++;

  // Check if Stripe links are configured
  const isConfigured = !STRIPE_LINKS[3].startsWith('STRIPE_LINK');

  if(isConfigured){
    // Use real Stripe Payment Links
    const link = STRIPE_LINKS[tpAmt] || STRIPE_LINKS.custom;
    // For custom links, Stripe handles the amount on their page
    window.open(link, '_blank');
    // Show thank you
    document.getElementById('tpSel').style.display='none';
    document.getElementById('tpTy').style.display='';
    document.getElementById('tpTA').textContent='$'+tpAmt.toFixed(2);
    document.getElementById('tpTS').textContent=R?'$'+R.as.toFixed(0)+'/yr':'big money';
  } else {
    // Demo mode ‚Äî show setup instructions in console, show thank you to user
    console.log('‚ö° WattWise Tip: $'+tpAmt.toFixed(2));
    console.log('To accept real payments, replace STRIPE_LINKS in the code with your Stripe Payment Link URLs.');
    console.log('Create them at: https://dashboard.stripe.com/payment-links');
    document.getElementById('tpSel').style.display='none';
    document.getElementById('tpTy').style.display='';
    document.getElementById('tpTA').textContent='$'+tpAmt.toFixed(2);
    document.getElementById('tpTS').textContent=R?'$'+R.as.toFixed(0)+'/yr':'big money';
  }
}
function cpSh(){const el=document.getElementById('shTxt'),t=el.textContent.replace('Copy','').trim();navigator.clipboard.writeText(t).then(()=>{el.querySelector('.btn-cp').textContent='Copied!';setTimeout(()=>el.querySelector('.btn-cp').textContent='Copy',2000)})}

function fire(){const c=document.getElementById('confC');c.innerHTML='';const cl=['#00DC82','#FACC15','#38BDF8','#F472B6','#A78BFA','#FB923C'];
  for(let i=0;i<50;i++){const p=document.createElement('div');p.className='confetti-p';p.style.cssText=`left:${Math.random()*100}%;width:${4+Math.random()*6}px;height:${(4+Math.random()*6)*1.4}px;background:${cl[i%6]};border-radius:${Math.random()>.5?'50%':'2px'};animation:confetti ${2+Math.random()*1.5}s ease-in ${Math.random()*.8}s forwards;transform:rotate(${Math.random()*720}deg);opacity:0`;c.appendChild(p)}setTimeout(()=>c.innerHTML='',4000)}

// ============================================================
// ADMIN PANEL & ANALYTICS
// ============================================================
let stats={searches:0,planClicks:0,provClicks:0,tipClicks:0};
const ADMIN_PIN_HASH='ww_admin_pin';

function hashPin(pin){let h=0;for(let i=0;i<pin.length;i++){h=((h<<5)-h)+pin.charCodeAt(i);h|=0}return h.toString(36)}

function setupPin(){
  const pin=prompt('Create a 4-6 digit admin PIN:');
  if(!pin||pin.length<4||pin.length>6||!/^\d+$/.test(pin)){alert('PIN must be 4-6 digits');return false}
  const pin2=prompt('Confirm your PIN:');
  if(pin!==pin2){alert('PINs do not match');return false}
  try{localStorage.setItem(ADMIN_PIN_HASH,hashPin(pin))}catch(e){}
  alert('Admin PIN set! Use this PIN to access the admin panel.');
  return true;
}

function checkPin(){
  const stored=localStorage.getItem(ADMIN_PIN_HASH);
  if(!stored)return setupPin();
  const pin=prompt('Enter admin PIN:');
  if(!pin)return false;
  if(hashPin(pin)===stored)return true;
  alert('Incorrect PIN');
  return false;
}

function resetPin(){
  if(confirm('Reset admin PIN? You will need to create a new one.')){
    localStorage.removeItem(ADMIN_PIN_HASH);
    alert('PIN removed. Next admin access will prompt you to create a new PIN.');
    xAd();
  }
}

// Load Stripe links from localStorage
function loadAdmin(){
  try{
    const s=localStorage.getItem('ww_stripe');
    if(s){const d=JSON.parse(s);
      if(d.s3)STRIPE_LINKS[3]=d.s3;if(d.s7)STRIPE_LINKS[7]=d.s7;
      if(d.s15)STRIPE_LINKS[15]=d.s15;if(d.sc)STRIPE_LINKS.custom=d.sc;
    }
  }catch(e){}
  updStripeStatus();
}
function saveAdmin(){
  const d={s3:document.getElementById('adS3').value.trim(),s7:document.getElementById('adS7').value.trim(),
    s15:document.getElementById('adS15').value.trim(),sc:document.getElementById('adSC').value.trim()};
  try{localStorage.setItem('ww_stripe',JSON.stringify(d))}catch(e){}
  if(d.s3)STRIPE_LINKS[3]=d.s3;if(d.s7)STRIPE_LINKS[7]=d.s7;
  if(d.s15)STRIPE_LINKS[15]=d.s15;if(d.sc)STRIPE_LINKS.custom=d.sc;
  updStripeStatus();
}
function updStripeStatus(){
  const el=document.getElementById('adStripeStatus');
  const live=!STRIPE_LINKS[3].startsWith('STRIPE_LINK');
  el.textContent=live?'‚úÖ Live ‚Äî tips will process through Stripe':'‚ö†Ô∏è Demo mode ‚Äî tips simulate only';
  el.className='ad-status '+(live?'live':'demo');
}
function updStats(){
  document.getElementById('adSearches').textContent=stats.searches;
  document.getElementById('adPlanClicks').textContent=stats.planClicks;
  document.getElementById('adProvClicks').textContent=stats.provClicks;
  document.getElementById('adTipClicks').textContent=stats.tipClicks;
}
function openAd(){
  if(!checkPin())return;
  document.getElementById('adOv').classList.add('open');document.body.style.overflow='hidden';
  // Populate fields from localStorage
  try{const s=localStorage.getItem('ww_stripe');if(s){const d=JSON.parse(s);
    document.getElementById('adS3').value=d.s3||'';document.getElementById('adS7').value=d.s7||'';
    document.getElementById('adS15').value=d.s15||'';document.getElementById('adSC').value=d.sc||'';
  }}catch(e){}
  updStripeStatus();updStats();loadSplit();loadBroker();loadCommissions();
}
function xAd(){document.getElementById('adOv').classList.remove('open');document.body.style.overflow=''}

// COMMISSION TRACKING
const BROKER_FIELDS=['adBrkLicense','adBrkName','adBrkEmail','adRepTXU','adRepReliant','adRepDirect','adRepGexa','adRepConstellation','adRepFrontier','adRepRhythm','adRepChariot','adRepPayless','adRepCirro','adErcotKey','adSMT','adEIA','adSupaURL','adSupaAnon','adSupaService'];
let brokerSaveTimer=null;
function saveBroker(){
  const d={};BROKER_FIELDS.forEach(f=>{const el=document.getElementById(f);if(el)d[f]=el.value});
  try{localStorage.setItem('ww_broker',JSON.stringify(d))}catch(e){}
  clearTimeout(brokerSaveTimer);
  brokerSaveTimer=setTimeout(()=>saveBrokerDB(d),1500);
  document.getElementById('adBrkSaveStatus').textContent='Saving...';
  document.getElementById('adBrkSaveStatus').style.color='var(--y)';
}
async function saveBrokerDB(d){
  if(!SUPABASE_URL||!SUPABASE_ANON_KEY)return;
  try{
    // Try PATCH first (update existing row id=1)
    const res=await fetch(SUPABASE_URL+'/rest/v1/broker_settings?id=eq.1',{
      method:'PATCH',headers:{'Content-Type':'application/json','apikey':SUPABASE_ANON_KEY,'Authorization':'Bearer '+SUPABASE_ANON_KEY,'Prefer':'return=headers-only'},
      body:JSON.stringify({settings:d,updated_at:new Date().toISOString()})
    });
    // If no rows matched, INSERT
    const count=res.headers.get('content-range');
    if(count&&count.endsWith('/0')){
      await fetch(SUPABASE_URL+'/rest/v1/broker_settings',{
        method:'POST',headers:{'Content-Type':'application/json','apikey':SUPABASE_ANON_KEY,'Authorization':'Bearer '+SUPABASE_ANON_KEY,'Prefer':'return=minimal'},
        body:JSON.stringify({id:1,settings:d,updated_at:new Date().toISOString()})
      });
    }
    document.getElementById('adBrkSaveStatus').textContent='‚úÖ Saved to database';
    document.getElementById('adBrkSaveStatus').style.color='var(--g)';
    setTimeout(()=>{const el=document.getElementById('adBrkSaveStatus');if(el)el.textContent=''},3000);
  }catch(e){
    console.warn('DB save failed:',e);
    document.getElementById('adBrkSaveStatus').textContent='‚ö†Ô∏è Saved locally only';
    document.getElementById('adBrkSaveStatus').style.color='var(--o)';
  }
}
async function loadBroker(){
  // Try Supabase first
  if(SUPABASE_URL&&SUPABASE_ANON_KEY){
    try{
      const res=await fetch(SUPABASE_URL+'/rest/v1/broker_settings?id=eq.1&select=settings',{
        headers:{'apikey':SUPABASE_ANON_KEY,'Authorization':'Bearer '+SUPABASE_ANON_KEY}
      });
      if(res.ok){
        const rows=await res.json();
        if(rows.length&&rows[0].settings){
          const d=rows[0].settings;
          BROKER_FIELDS.forEach(f=>{const el=document.getElementById(f);if(el&&d[f])el.value=d[f]});
          try{localStorage.setItem('ww_broker',JSON.stringify(d))}catch(e){}
          return;
        }
      }
    }catch(e){console.warn('DB load failed, using localStorage:',e)}
  }
  // Fallback: localStorage
  try{const s=localStorage.getItem('ww_broker');if(s){const d=JSON.parse(s);
    BROKER_FIELDS.forEach(f=>{const el=document.getElementById(f);if(el&&d[f])el.value=d[f]});
  }}catch(e){}
}
function saveSplit(){
  const pct=parseInt(document.getElementById('adSplitPct').value)||50;
  document.getElementById('adSplitA').textContent=pct;
  document.getElementById('adSplitR').textContent=100-pct;
  try{localStorage.setItem('ww_split',pct)}catch(e){}
}
function loadSplit(){
  try{const s=localStorage.getItem('ww_split');if(s){const p=parseInt(s);
    document.getElementById('adSplitPct').value=p;
    document.getElementById('adSplitA').textContent=p;
    document.getElementById('adSplitR').textContent=100-p;
  }}catch(e){}
}
async function addCommission(){
  if(!SB_URL||!SB_KEY){alert('Supabase not configured');return}
  const amt=parseFloat(document.getElementById('adCommAmt').value);
  if(!amt||amt<=0){alert('Enter a valid amount');return}
  const pct=parseInt(document.getElementById('adSplitPct').value)||50;
  const entry={
    affiliate_partner:document.getElementById('adCommPartner').value,
    gross_amount:amt,
    andy_share:+(amt*pct/100).toFixed(2),
    robert_share:+(amt*(100-pct)/100).toFixed(2),
    split_pct:pct,
    customer_zip:document.getElementById('adCommZip').value.trim()||null,
    status:document.getElementById('adCommStatus').value,
    notes:document.getElementById('adCommNotes').value.trim()||null,
    enrollment_date:new Date().toISOString().split('T')[0]
  };
  try{
    const res=await fetch(SB_URL+'/rest/v1/commissions',{method:'POST',headers:{'Content-Type':'application/json','apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Prefer':'return=representation'},body:JSON.stringify(entry)});
    if(res.ok){
      document.getElementById('adCommAmt').value='';
      document.getElementById('adCommZip').value='';
      document.getElementById('adCommNotes').value='';
      loadCommissions();
    }else{const e=await res.text();alert('Error: '+e)}
  }catch(e){alert('Network error: '+e.message)}
}
async function loadCommissions(){
  if(!SB_URL||!SB_KEY)return;
  try{
    // Load commissions
    const res=await fetch(SB_URL+'/rest/v1/commissions?order=created_at.desc&limit=50',{headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY}});
    if(res.ok){
      const data=await res.json();
      let totalGross=0,totalAndy=0,totalRobert=0,pending=0;
      data.forEach(c=>{totalGross+=c.gross_amount;totalAndy+=c.andy_share;totalRobert+=c.robert_share;if(c.status==='pending')pending+=c.gross_amount});
      document.getElementById('adTotalRev').textContent='$'+totalGross.toFixed(0);
      document.getElementById('adAndyRev').textContent='$'+totalAndy.toFixed(0);
      document.getElementById('adRobertRev').textContent='$'+totalRobert.toFixed(0);
      document.getElementById('adPendingComm').textContent='$'+pending.toFixed(0);
      // Render log
      const log=document.getElementById('adCommLog');
      if(data.length===0){log.innerHTML='<div style="text-align:center;padding:12px;color:#555;font-size:11px">No commissions yet. They\'ll appear here as you add them.</div>';return}
      log.innerHTML=data.map(c=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.03);font-size:11px;font-family:var(--fm)">
        <div><span style="color:#fff">$${c.gross_amount.toFixed(2)}</span> <span style="color:#666">from</span> <span style="color:var(--g)">${c.affiliate_partner}</span>
        ${c.customer_zip?'<span style="color:#555"> ¬∑ ZIP '+c.customer_zip+'</span>':''}
        ${c.notes?'<br><span style="color:#555;font-size:10px">'+c.notes+'</span>':''}</div>
        <div style="text-align:right"><span style="padding:2px 6px;border-radius:3px;font-size:9px;${c.status==='paid'?'background:rgba(0,220,130,.15);color:var(--g)':c.status==='confirmed'?'background:rgba(59,130,246,.15);color:var(--b)':'background:rgba(250,204,21,.1);color:var(--y)'}">${c.status}</span>
        <br><span style="color:#444;font-size:9px">${c.enrollment_date||''}</span></div>
      </div>`).join('');
    }
    // Load click count
    const cRes=await fetch(SB_URL+'/rest/v1/click_tracking?select=id&limit=1',{headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Prefer':'count=exact'}});
    if(cRes.ok){const ct=cRes.headers.get('content-range');if(ct){const total=ct.split('/')[1];document.getElementById('adTotalClicks').textContent=total||'0'}}
  }catch(e){console.log('Commission load error:',e)}
}

// Triple-click logo to open admin
let logoClicks=0,logoTimer=null;
document.querySelector('.logo').addEventListener('click',()=>{
  logoClicks++;if(logoClicks>=4){logoClicks=0;clearTimeout(logoTimer);openAd()}
  else{clearTimeout(logoTimer);logoTimer=setTimeout(()=>logoClicks=0,800)}
});
// URL hash access
if(location.hash==='#admin')setTimeout(openAd,500);
window.addEventListener('hashchange',()=>{if(location.hash==='#admin')openAd()});
// Hidden URL access: ?settings=1
if(new URLSearchParams(location.search).get('settings')==='1')setTimeout(openAd,500);

// Init
loadAdmin();
</script>

</body>
</html>